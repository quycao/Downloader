!function(e){function t(t){for(var n,o,s=t[0],l=t[1],u=t[2],d=0,h=[];d<s.length;d++)o=s[d],r[o]&&h.push(r[o][0]),r[o]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);for(c&&c(t);h.length;)h.shift()();return a.push.apply(a,u||[]),i()}function i(){for(var e,t=0;t<a.length;t++){for(var i=a[t],n=!0,s=1;s<i.length;s++){var l=i[s];0!==r[l]&&(n=!1)}n&&(a.splice(t--,1),e=o(o.s=i[0]))}return e}var n={},r={4:0};var a=[];function o(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=n,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},o.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="./";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var c=l;a.push([53,0]),i()}({100:function(e,t,i){"use strict";e.exports=function(e){return"function"==typeof e}},101:function(e,t,i){"use strict";var n=i(27),r=Array.prototype.forEach,a=Object.create;e.exports=function(e){var t=a(null);return r.call(arguments,function(e){n(e)&&function(e,t){var i;for(i in e)t[i]=e[i]}(Object(e),t)}),t}},102:function(e,t,i){"use strict";var n=i(27);e.exports=function(e){if(!n(e))throw new TypeError("Cannot use null or undefined");return e}},103:function(e,t,i){"use strict";e.exports=function(){}},104:function(e,t,i){"use strict";var n=i(27),r=Object.keys;e.exports=function(e){return r(n(e)?Object(e):e)}},105:function(e,t,i){"use strict";e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},106:function(e,t,i){"use strict";e.exports=i(105)()?Object.keys:i(104)},107:function(e,t,i){"use strict";var n=i(106),r=i(102),a=Math.max;e.exports=function(e,t){var i,o,s,l=a(arguments.length,2);for(e=Object(r(e)),s=function(n){try{e[n]=t[n]}catch(e){i||(i=e)}},o=1;o<l;++o)t=arguments[o],n(t).forEach(s);if(void 0!==i)throw i;return e}},108:function(e,t,i){"use strict";e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},109:function(e,t,i){"use strict";e.exports=i(108)()?Object.assign:i(107)},110:function(e,t,i){"use strict";var n=i(109),r=i(101),a=i(100),o=i(99);(e.exports=function(e,t){var i,a,s,l,u;return arguments.length<2||"string"!=typeof e?(l=t,t=e,e=null):l=arguments[2],null==e?(i=s=!0,a=!1):(i=o.call(e,"c"),a=o.call(e,"e"),s=o.call(e,"w")),u={value:t,configurable:i,enumerable:a,writable:s},l?n(r(l),u):u}).gs=function(e,t,i){var s,l,u,c;return"string"!=typeof e?(u=i,i=t,t=e,e=null):u=arguments[3],null==t?t=void 0:a(t)?null==i?i=void 0:a(i)||(u=i,i=void 0):(u=t,t=i=void 0),null==e?(s=!0,l=!1):(s=o.call(e,"c"),l=o.call(e,"e")),c={get:t,set:i,configurable:s,enumerable:l},u?n(r(u),c):c}},131:function(e,t){},27:function(e,t,i){"use strict";var n=i(103)();e.exports=function(e){return e!==n&&null!==e}},28:function(e,t,i){"use strict";var n,r,a,o,s,l,u,c=i(110),d=i(96),h=Function.prototype.apply,f=Function.prototype.call,p=Object.create,m=Object.defineProperty,_=Object.defineProperties,y=Object.prototype.hasOwnProperty,v={configurable:!0,enumerable:!1,writable:!0};s={on:n=function(e,t){var i;return d(t),y.call(this,"__ee__")?i=this.__ee__:(i=v.value=p(null),m(this,"__ee__",v),v.value=null),i[e]?"object"==typeof i[e]?i[e].push(t):i[e]=[i[e],t]:i[e]=t,this},once:r=function(e,t){var i,r;return d(t),r=this,n.call(this,e,i=function(){a.call(r,e,i),h.call(t,this,arguments)}),i.__eeOnceListener__=t,this},off:a=function(e,t){var i,n,r,a;if(d(t),!y.call(this,"__ee__"))return this;if(!(i=this.__ee__)[e])return this;if("object"==typeof(n=i[e]))for(a=0;r=n[a];++a)r!==t&&r.__eeOnceListener__!==t||(2===n.length?i[e]=n[a?0:1]:n.splice(a,1));else n!==t&&n.__eeOnceListener__!==t||delete i[e];return this},emit:o=function(e){var t,i,n,r,a;if(y.call(this,"__ee__")&&(r=this.__ee__[e]))if("object"==typeof r){for(i=arguments.length,a=new Array(i-1),t=1;t<i;++t)a[t-1]=arguments[t];for(r=r.slice(),t=0;n=r[t];++t)h.call(n,this,a)}else switch(arguments.length){case 1:f.call(r,this);break;case 2:f.call(r,this,arguments[1]);break;case 3:f.call(r,this,arguments[1],arguments[2]);break;default:for(i=arguments.length,a=new Array(i-1),t=1;t<i;++t)a[t-1]=arguments[t];h.call(r,this,a)}}},l={on:c(n),once:c(r),off:c(a),emit:c(o)},u=_({},l),e.exports=t=function(e){return null==e?p(u):_(Object(e),l)},t.methods=s},29:function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hostMapping={"24h.com.vn":".media-player","phimmoi.net":".media-player","clipvuivn.com":"#video-js","kenhvideo.com":".jwplayer","chimsedinang.com":"#clh-vid-video","phimnhanh.net":"#player","eva.vn":".zPlayer_mainContainer","cnet.com":".videoPlayer","tv.tuoitre.vn":"#video-wrapper"}}return n(e,[{key:"hasSpecialSupport",value:function(){return Object.keys(this.hostMapping).some(function(e){return window.location.host.includes(e)})}},{key:"getNode",value:function(e){var t=(e=e||window.location.host).replace("www.",""),i=this.hostMapping[t];return i?document.querySelector(i):null}}]),e}();t.a=new r},51:function(e,t,i){"use strict";(function(e){var n=i(6),r=i(29),a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o="0!important",s="100%!important",l={left:o,top:o,padding:o,margin:o,border:"0px none!important",width:s,height:s,"min-width":s,"max-width":"none!important","min-height":s,"max-height":"none!important",transform:"none!important"},u={display:"none!important",visibility:"hidden!important",opacity:o,width:o,height:o,margin:o,padding:o,border:"0px none!important",overflow:"hidden!important"},c={left:o,top:o,padding:o,margin:o,border:"0px none!important",width:s,height:s,"min-width":s,"max-width":"none!important","min-height":s,"max-height":"none!important",overflow:"hidden!important",transform:"none!important",display:"block!important"},d={"font-size":o,"line-height":o,"z-index":Number.MAX_SAFE_INTEGER-1+"!important"},h={width:s,height:s,_width:"100%",_height:"100%"},f={childList:!1,attributes:!0,characterData:!1,subtree:!1,attributeOldValue:!1,characterDataOldValue:!1,attributeFilter:["style","width","height"]},p=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._savedStyles=new Map,this._appliedStyles=new Map,this._observer=new MutationObserver(this._onStylePropertyChange.bind(this))}return a(t,[{key:"_onStylePropertyChange",value:function(e){var t=e.filter(function(e){var t=e.target,i=t.getAttribute(e.attributeName)||"",r=this._appliedStyles.get(t),a=void 0,o=void 0;switch(e.attributeName){case"style":for(o in a=n.a.parseStyleAttr(i),r)if(a[o]!==r[o])return!0;return!1;case"width":case"height":return r["_"+e.attributeName]!==i}return!1}.bind(this)).map(function(e){return e.target});this._reApplyStyles(t)}},{key:"_watchStyleChanges",value:function(){this._appliedStyles.forEach(function(e,t){this._observer.observe(t,f)}.bind(this))}},{key:"_stopWatchingStyleChanges",value:function(){this._observer.disconnect()}},{key:"_saveStyle",value:function(e){var t=e.style,i={};for(var n in t)t.hasOwnProperty(n)&&""!==t[n]&&(i[n]=e.style[n]);["OBJECT","EMBED","IFRAME"].indexOf(e.tagName.toUpperCase())>-1&&e.width&&(i._width=e.width,i._height=e.height),0!==e.scrollTop&&(i._scrollTop=e.scrollTop),this._savedStyles.set(e,i)}},{key:"_restoreStyle",value:function(e){var t=e.style,i=this._savedStyles.get(e);if(i){for(var n in t)t.hasOwnProperty(n)&&(n in i?t[n]=i[n]:""!==t[n]&&(t[n]=""));i._width&&(e.width=i._width),i._height&&(e.height=i._height),i._scrollTop&&(e.scrollTop=i._scrollTop)}}},{key:"_saveAppliedStyle",value:function(e,t){var i=this._appliedStyles.get(e)||{};for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);this._appliedStyles.set(e,i)}},{key:"_applyStyleForNode",value:function(e){var t=this._appliedStyles.get(e);t&&n.a.setStyleAttr(e,t),t._width&&(e.width=t._width),t._height&&(e.height=t._height)}},{key:"_maximizeNode",value:function(i){var n=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=null,o=t._getNodeSize(i);this._savedStyles.clear(),this._appliedStyles.clear(),this._saveAppliedStyle(i,l);var s=i.querySelector("embed");s&&(this._saveStyle(s),this._saveAppliedStyle(s,h));for(var f=i;f&&f!==document;f=f.parentNode)if(!f.matches("head, script, style, link, meta")){if(this._saveStyle(f),this._saveAppliedStyle(f,c),r&&this._saveAppliedStyle(f,d),f.matches("object, embed")&&this._saveAppliedStyle(f,h),f.matches("iframe"))r=!0;else if(!r&&(Math.min(f.parentNode.scrollWidth,f.parentNode.offsetWidth)!==o.width||Math.min(f.parentNode.scrollHeight,f.parentNode.offsetHeight)!==o.height)){r=!0;var p={"font-size":(a=window.getComputedStyle(f))["font-size"]+"!important","line-height":a["line-height"]+"!important","z-index":Number.MAX_SAFE_INTEGER-1+"!important"};this._saveAppliedStyle(f,p)}r&&t._iterateSiblings(f,function(e){e.matches("head, script, style, link, meta")||(n._saveStyle(e),n._saveAppliedStyle(e,u))})}var m=function(){n._reApplyStyles(),n._watchStyleChanges()};e.env.MOBILE_BUILD?m():window.addEventListener("resize",m)}},{key:"_restoreNode",value:function(){var e=this;this._savedStyles.forEach(function(t,i){e._restoreStyle(i)}),this._savedStyles.clear(),this._appliedStyles.clear()}},{key:"_reApplyStyles",value:function(e){var t=this;Array.isArray(e)?e.forEach(this._applyStyleForNode.bind(this)):this._appliedStyles.forEach(function(e,i){t._applyStyleForNode(i)})}},{key:"pin",value:function(e,i){var n=void 0,a=void 0;if(!this._currentPiP){if(e instanceof HTMLElement){if(!t._nodeInDocument(e))return void console.warn("player node is detached from the document!");a=e,n=!1}else a=e.node,n=Boolean(e.restore&&e.detach);r.a.hasSpecialSupport()&&(a=r.a.getNode(),n=!1);var o=t._getNodeSize(a),s=void 0;if(n){if(!e.detach(this._maximizeNode.bind(this)))return;s={player:e}}else this._maximizeNode(a,i),s={node:a};return this._currentPiP=s,o}console.warn("It is already PIPed.")}},{key:"restore",value:function(){this._currentPiP?(this._stopWatchingStyleChanges(),this._currentPiP.player?this._currentPiP.player.restore(this._restoreNode.bind(this)):this._restoreNode(this._currentPiP.node),this._currentPiP=null):console.warn("Nothing to restore, we're not in PIP.")}},{key:"isPanelMode",get:function(){return!!this._currentPiP}}],[{key:"_getNodeSize",value:function(e){var t=n.a.getEmbedSize(e);return{width:t.width||640,height:t.height||480}}},{key:"_iterateSiblings",value:function(e,t){for(var i=e.parentNode&&e.parentNode.children,n=0;i&&n<i.length;n++)i[n]!==e&&t(i[n])}},{key:"_nodeInDocument",value:function(e){for(;e&&e!==document;)e=e.parentNode;return e===document}}]),t}();t.a=p}).call(this,i(12))},53:function(e,t,i){"use strict";i.r(t);var n=i(0),r=i(2),a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var o=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return a(e,[{key:"_sendMessage",value:function(e,t,i){chrome.runtime.sendMessage({requestType:"cache",method:e,params:t},i)}},{key:"get",value:function(e){return new Promise(function(t,i){this._sendMessage("get",{key:e},function(e){e&&"reject"!==e.success?t(e.data):i(e)})}.bind(this))}},{key:"put",value:function(e,t,i){this._sendMessage("put",{key:e,value:t,ttl:i})}},{key:"delete",value:function(e){this._sendMessage("delete",{key:e})}},{key:"proxy",value:function(e,t,i,n){var r=this;return new Promise(function(a){this.get(t+n).then(a).catch(function(){new Promise(i.call(e,n)).then(function(e){r.put(t+n,e)}).then(function(e){a(e)})})}.bind(this))}}]),e}());function s(e,t,i,n){return{match:function(t){if(e.filename&&e.filename!==t.filename)return!1;var i=t.host;if(!i||t.title)return!1;if(!e.hosts)return!0;for(var n=e.hosts.length-1;n>=0;n--)if(i.endsWith(e.hosts[n]))return!0;return!1},location:Array.isArray(t)?t:[t],selector:i,auxSelector:n}}function l(e,t,i){return s({hosts:[".googlevideo.com","docs.google.com"],filename:"videoplayback"},e,t,i)}function u(e,t){return l(e,"title",t)}var c=[s({hosts:["ustream.tv"]},/^ustream.tv\/recorded\/([0-9]+)/i,"#ViewerContent h2"),s({hosts:["yan.vn"]},/^yan\.vn/i,'title, [role="complementary"] h3'),s({hosts:["vcdn.vn",".googlevideo.com","docs.google.com"]},/^phim22\.com/i,"title"),s({hosts:["olivia24.com"]},/^olivia24\.com/,"h1.visible-lg.visible-md"),s({},/vipphim\.net/,"title"),s({},/kenh14\.vn/,"h1.title"),s({},/vtv\.vn/,"h1.news-title,h1.video-title"),s({},/dantri\.com\.vn/,"#video-title"),s({hosts:[".memeclip.com"]},/nguoiduatin\.vn/,"title"),l(/^phim3s.net\/phim/i,"h2.title a",".serverlist .server li a.active"),l(/^thegioiphim\.eu\/movie-episode-full\.php/i,".category-main"),l(/^hayghe\.com\/xem-phim/i,"#tit_player"),l(/^phim14\.net\/xem-phim/i,".blocktitle h1 a",".server_item .active a"),l(/^phimnhanh\.net\/movie/i,"h1 > a",".epicurrent"),l(/^xemnghe\.com\/phim/i,"h1"),l(/^phimhd\.vn\/xem-phim/i,"h1.title","a.playing"),u(/^phimmoi\.net\/phim/i,".episode-link.active"),u(/^phimtv\.vn\/xem-phim/i,"a.playing"),s({hosts:["203.162.121.25:88","110.164.180.35","130.211.247.87"]},/^m-viet\.com/i,"h1"),s({hosts:["memeclip.com"]},/^meme\.vn/i,"h1"),s({hosts:["memeclip.com"]},/^doisongphapluat\.com/,"title"),s({},/^keeng\.vn\/video\//,"title"),s({},/^vlxx\.tv\/video/,"title"),s({},/^keeng\.vn\/video/,".info-keeng-player"),s({},/^kickstarter\.com/,"title"),s({},/^tv\.tuoitre\.vn/,".info h1"),s({},/video\.vietnamnet\.vn/,"h3.video-main-home-title"),u(/phim/i)],d=/^((xem )?phim)|(video:)/i,h=/(-? picasaweb( \d+)?)|(\| server .*)?$/i,f=/^https?:\/\/(www\.)?/i;var p=i(9),m=i(5),_=i(4),y=i(3);function v(e){if(!function(e){return!(!e||m.a.check(e)||e.src&&m.a.check(e.src)&&m.a.check(e.src,"requests"))}(e))return null;if(-1!==["PARAM","SOURCE"].indexOf(e.tagName)&&(e=e.parentElement),"OBJECT"===e.tagName){var t=e.querySelectorAll("embed");t&&1===t.length&&(e=t[0])}return e}function g(e){return{nocache:!!e.nocache,getPlaylist:function(e){var t=e.parse,i=e.request;if(!i)return t;var r=i.url||function(e){return e},a=i.params||function(){},o=i.headers||function(){};return function(e){var s=r(e);return s?new Promise(function(r,l){n.Utils.send(i.method,s,a(e),o(e)).then(function(e){try{var i=t(s,e);if(!i)return void r([]);Array.isArray(i)||(i=[i]),Promise.all(i).then(function(e){r(e)}).catch(function(e){console.warn(e),l(e)})}catch(e){console.warn(e),l()}}).catch(function(e){console.log(e)})}):t(e)}}(e)}}var w={extract:function(e){var t=void 0;return e.getAttribute("flashvars").split("&").forEach(function(e){"file"===(e=e.split("="))[0]&&(t=decodeURIComponent(e[1]))}),t},parsePlaylist:function(e,t){var i=n.Utils.xmlParser.parseFromString(t,"text/xml"),r=[];return n.Utils.queryAll("track",i).forEach(function(e){n.Utils.queryAll("location, highquality, lowquality",e).forEach(function(t){var i=t.textContent.trim(),a=n.UrlUtils.parse(i);if(!Object(_.f)(a.ext)){var o=[e.querySelector("title").textContent.trim()],s=e.querySelector("singer")||e.querySelector("creator");s&&""!==s.textContent.trim()&&o.unshift(s.textContent.trim()),a.type="mp3"===a.ext?"audio":"video",a.title=o.join(" – "),a.quality=y.a.getJWQuality(t.nodeName),r.push(a)}})}),r}},b=function(e,t){if("string"!=typeof e||"string"!=typeof t)return e;if("videoplayback"===e)return E(t);var i=e.replace(/[\W+_]/g,""),n=i.length,r=function(e){var t=e.match(/\d/g);if(t)return t.length;return 0}(i)/n;return.99>r+function(e){var t=e.match(/[A-Za-z]/g);if(t)return t.length;return 0}(i)/n?e:r>=.5?E(t):e};function E(e){return e.replace(/xem|phim|clips?|videos?|online/gi,"").replace(/^\s?-\s?/gi,"").trim()}var S=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},T=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},k=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},P=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},O=function(){function e(){S(this,e),this.listeners={}}return e.prototype.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},e.prototype.off=function(e,t){if(!this.listeners[e])return!1;var i=this.listeners[e].indexOf(t);return this.listeners[e].splice(i,1),i>-1},e.prototype.trigger=function(e){var t=this.listeners[e],i=void 0,n=void 0,r=void 0;if(t)if(2===arguments.length)for(n=t.length,i=0;i<n;++i)t[i].call(this,arguments[1]);else for(r=Array.prototype.slice.call(arguments,1),n=t.length,i=0;i<n;++i)t[i].apply(this,r)},e.prototype.dispose=function(){this.listeners={}},e.prototype.pipe=function(e){this.on("data",function(t){e.push(t)})},e}(),A=function(e){function t(){S(this,t);var i=P(this,e.call(this));return i.buffer="",i}return k(t,e),t.prototype.push=function(e){var t=void 0;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)},t}(O),C=function(e){for(var t=e.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),i={},n=t.length,r=void 0;n--;)""!==t[n]&&((r=/([^=]*)=(.*)/.exec(t[n]).slice(1))[0]=r[0].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^['"](.*)['"]$/g,"$1"),i[r[0]]=r[1]);return i},x=function(e){function t(){S(this,t);var i=P(this,e.call(this));return i.customParsers=[],i}return k(t,e),t.prototype.push=function(e){var t=void 0,i=void 0;if(0!==(e=e.replace(/^[\u0000\s]+|[\u0000\s]+$/g,"")).length)if("#"===e[0]){for(var n=0;n<this.customParsers.length;n++)if(this.customParsers[n].call(this,e))return;if(0===e.indexOf("#EXT"))if(e=e.replace("\r",""),t=/^#EXTM3U/.exec(e))this.trigger("data",{type:"tag",tagType:"m3u"});else{if(t=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(e))return i={type:"tag",tagType:"inf"},t[1]&&(i.duration=parseFloat(t[1])),t[2]&&(i.title=t[2]),void this.trigger("data",i);if(t=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(e))return i={type:"tag",tagType:"targetduration"},t[1]&&(i.duration=parseInt(t[1],10)),void this.trigger("data",i);if(t=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(e))return i={type:"tag",tagType:"totalduration"},t[1]&&(i.duration=parseInt(t[1],10)),void this.trigger("data",i);if(t=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(e))return i={type:"tag",tagType:"version"},t[1]&&(i.version=parseInt(t[1],10)),void this.trigger("data",i);if(t=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(e))return i={type:"tag",tagType:"media-sequence"},t[1]&&(i.number=parseInt(t[1],10)),void this.trigger("data",i);if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(e))return i={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(i.number=parseInt(t[1],10)),void this.trigger("data",i);if(t=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(e))return i={type:"tag",tagType:"playlist-type"},t[1]&&(i.playlistType=t[1]),void this.trigger("data",i);if(t=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(e))return i={type:"tag",tagType:"byterange"},t[1]&&(i.length=parseInt(t[1],10)),t[2]&&(i.offset=parseInt(t[2],10)),void this.trigger("data",i);if(t=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(e))return i={type:"tag",tagType:"allow-cache"},t[1]&&(i.allowed=!/NO/.test(t[1])),void this.trigger("data",i);if(t=/^#EXT-X-MAP:?(.*)$/.exec(e)){if(i={type:"tag",tagType:"map"},t[1]){var r=C(t[1]);if(r.URI&&(i.uri=r.URI),r.BYTERANGE){var a=r.BYTERANGE.split("@"),o=a[0],s=a[1];i.byterange={},o&&(i.byterange.length=parseInt(o,10)),s&&(i.byterange.offset=parseInt(s,10))}}this.trigger("data",i)}else if(t=/^#EXT-X-STREAM-INF:?(.*)$/.exec(e)){if(i={type:"tag",tagType:"stream-inf"},t[1]){if(i.attributes=C(t[1]),i.attributes.RESOLUTION){var l=i.attributes.RESOLUTION.split("x"),u={};l[0]&&(u.width=parseInt(l[0],10)),l[1]&&(u.height=parseInt(l[1],10)),i.attributes.RESOLUTION=u}i.attributes.BANDWIDTH&&(i.attributes.BANDWIDTH=parseInt(i.attributes.BANDWIDTH,10)),i.attributes["PROGRAM-ID"]&&(i.attributes["PROGRAM-ID"]=parseInt(i.attributes["PROGRAM-ID"],10))}this.trigger("data",i)}else{if(t=/^#EXT-X-MEDIA:?(.*)$/.exec(e))return i={type:"tag",tagType:"media"},t[1]&&(i.attributes=C(t[1])),void this.trigger("data",i);if(t=/^#EXT-X-ENDLIST/.exec(e))this.trigger("data",{type:"tag",tagType:"endlist"});else if(t=/^#EXT-X-DISCONTINUITY/.exec(e))this.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(t=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(e))return i={type:"tag",tagType:"program-date-time"},t[1]&&(i.dateTimeString=t[1],i.dateTimeObject=new Date(t[1])),void this.trigger("data",i);if(t=/^#EXT-X-KEY:?(.*)$/.exec(e))return i={type:"tag",tagType:"key"},t[1]&&(i.attributes=C(t[1]),i.attributes.IV&&("0x"===i.attributes.IV.substring(0,2).toLowerCase()&&(i.attributes.IV=i.attributes.IV.substring(2)),i.attributes.IV=i.attributes.IV.match(/.{8}/g),i.attributes.IV[0]=parseInt(i.attributes.IV[0],16),i.attributes.IV[1]=parseInt(i.attributes.IV[1],16),i.attributes.IV[2]=parseInt(i.attributes.IV[2],16),i.attributes.IV[3]=parseInt(i.attributes.IV[3],16),i.attributes.IV=new Uint32Array(i.attributes.IV))),void this.trigger("data",i);if(t=/^#EXT-X-START:?(.*)$/.exec(e))return i={type:"tag",tagType:"start"},t[1]&&(i.attributes=C(t[1]),i.attributes["TIME-OFFSET"]=parseFloat(i.attributes["TIME-OFFSET"]),i.attributes.PRECISE=/YES/.test(i.attributes.PRECISE)),void this.trigger("data",i);if(t=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(e))return i={type:"tag",tagType:"cue-out-cont"},t[1]?i.data=t[1]:i.data="",void this.trigger("data",i);if(t=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(e))return i={type:"tag",tagType:"cue-out"},t[1]?i.data=t[1]:i.data="",void this.trigger("data",i);if(t=/^#EXT-X-CUE-IN:?(.*)?$/.exec(e))return i={type:"tag",tagType:"cue-in"},t[1]?i.data=t[1]:i.data="",void this.trigger("data",i);this.trigger("data",{type:"tag",data:e.slice(4)})}}}else this.trigger("data",{type:"comment",text:e.slice(1)})}else this.trigger("data",{type:"uri",uri:e})},t.prototype.addParser=function(e){var t=this,i=e.expression,n=e.customType,r=e.dataParser,a=e.segment;"function"!=typeof r&&(r=function(e){return e}),this.customParsers.push(function(e){if(i.exec(e))return t.trigger("data",{type:"custom",data:r(e),customType:n,segment:a}),!0})},t}(O),U=function(e){function t(){S(this,t);var i=P(this,e.call(this));i.lineStream=new A,i.parseStream=new x,i.lineStream.pipe(i.parseStream);var n=i,r=[],a={},o=void 0,s=void 0,l={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},u=0;return i.manifest={allowCache:!0,discontinuityStarts:[],segments:[]},i.parseStream.on("data",function(e){var t=void 0,i=void 0;({tag:function(){(({"allow-cache":function(){this.manifest.allowCache=e.allowed,"allowed"in e||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var t={};"length"in e&&(a.byterange=t,t.length=e.length,"offset"in e||(this.trigger("info",{message:"defaulting offset to zero"}),e.offset=0)),"offset"in e&&(a.byterange=t,t.offset=e.offset)},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),e.duration>0&&(a.duration=e.duration),0===e.duration&&(a.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=r},key:function(){e.attributes?"NONE"!==e.attributes.METHOD?e.attributes.URI?(e.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),s={method:e.attributes.METHOD||"AES-128",uri:e.attributes.URI},void 0!==e.attributes.IV&&(s.iv=e.attributes.IV)):this.trigger("warn",{message:"ignoring key declaration without URI"}):s=null:this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(e.number)?this.manifest.mediaSequence=e.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+e.number})},"discontinuity-sequence":function(){isFinite(e.number)?(this.manifest.discontinuitySequence=e.number,u=e.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+e.number})},"playlist-type":function(){/VOD|EVENT/.test(e.playlistType)?this.manifest.playlistType=e.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+e.playlist})},map:function(){o={},e.uri&&(o.uri=e.uri),e.byterange&&(o.byterange=e.byterange)},"stream-inf":function(){this.manifest.playlists=r,this.manifest.mediaGroups=this.manifest.mediaGroups||l,e.attributes?(a.attributes||(a.attributes={}),T(a.attributes,e.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||l,e.attributes&&e.attributes.TYPE&&e.attributes["GROUP-ID"]&&e.attributes.NAME){var n=this.manifest.mediaGroups[e.attributes.TYPE];n[e.attributes["GROUP-ID"]]=n[e.attributes["GROUP-ID"]]||{},t=n[e.attributes["GROUP-ID"]],(i={default:/yes/i.test(e.attributes.DEFAULT)}).default?i.autoselect=!0:i.autoselect=/yes/i.test(e.attributes.AUTOSELECT),e.attributes.LANGUAGE&&(i.language=e.attributes.LANGUAGE),e.attributes.URI&&(i.uri=e.attributes.URI),e.attributes["INSTREAM-ID"]&&(i.instreamId=e.attributes["INSTREAM-ID"]),e.attributes.CHARACTERISTICS&&(i.characteristics=e.attributes.CHARACTERISTICS),e.attributes.FORCED&&(i.forced=/yes/i.test(e.attributes.FORCED)),t[e.attributes.NAME]=i}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){u+=1,a.discontinuity=!0,this.manifest.discontinuityStarts.push(r.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=e.dateTimeString,this.manifest.dateTimeObject=e.dateTimeObject),a.dateTimeString=e.dateTimeString,a.dateTimeObject=e.dateTimeObject},targetduration:function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+e.duration}):this.manifest.targetDuration=e.duration},totalduration:function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid total duration: "+e.duration}):this.manifest.totalDuration=e.duration},start:function(){e.attributes&&!isNaN(e.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:e.attributes["TIME-OFFSET"],precise:e.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){a.cueOut=e.data},"cue-out-cont":function(){a.cueOutCont=e.data},"cue-in":function(){a.cueIn=e.data}})[e.tagType]||function(){}).call(n)},uri:function(){a.uri=e.uri,r.push(a),!this.manifest.targetDuration||"duration"in a||(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),a.duration=this.manifest.targetDuration),s&&(a.key=s),a.timeline=u,o&&(a.map=o),a={}},comment:function(){},custom:function(){e.segment?(a.custom=a.custom||{},a.custom[e.customType]=e.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[e.customType]=e.data)}})[e.type].call(n)}),i}return k(t,e),t.prototype.push=function(e){this.lineStream.push(e)},t.prototype.end=function(){this.lineStream.push("\n")},t.prototype.addParser=function(e){this.parseStream.addParser(e)},t}(O),N={LOW:5e5,MEDIUM:1e6,STANDARD:2e6,HIGH:4e6};function I(e,t){var i=new U;i.push(e),i.end();var r=i.manifest.playlists;if(r&&r.length)return(r=r.sort(function(e,t){return e.attributes.BANDWIDTH&&t.attributes.BANDWIDTH?e.attributes.BANDWIDTH<t.attributes.BANDWIDTH:0})).map(function(e){var i,r=n.UrlUtils.parse(e.uri);if(r.type="video",e.attributes&&e.attributes&&e.attributes.RESOLUTION){var a=e.attributes.RESOLUTION.height,o=y.a.getQualityNameByResolution(a);o&&(r.quality=o),r.resolution=a?a+"p":""}if(r.quality||(e.attributes.BANDWIDTH?r.quality=(i=e.attributes.BANDWIDTH)<N.LOW?"Low":i<N.MEDIUM?"Medium":i<N.STANDARD?"Standard":i<N.HIGH?"High":"Highest":r.quality="Standard"),!r.url.match(/https?:/)){var s=t.pathname.split("/");s=s.slice(0,s.length-1),r.url=t.protocol+"//"+t.host+s.join("/")+"/"+r.url}return r.title=document.title.trim(),r.filename=r.title,r._hls=!0,r})}var L=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var q=function(){function e(t){var i=t.name,n=t.node,r=t.ids,a=t.scraper,o=t.pipFunctions,s=t.opts,l=void 0===s?{}:s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=i,this.node=n,this.ids=r,this.scraper=a,this.opts=l,o&&o.restore&&o.detach&&(this.restore=o.restore,this.detach=o.detach)}return L(e,[{key:"getMedia",value:function(){var e=this,t=[],i=n.Utils.flatten(this.ids);return i.length?this.scraper?(i.forEach(function(i){if(e.scraper.nocache)t.push(e.scraper.getPlaylist(i));else if(!i.url||!m.a.check(i.url)){var n=e.name+"_"+(i.url||i),r=new Promise(function(t){o.get(n).then(t).catch(function(){Promise.resolve(e.scraper.getPlaylist(i)).then(function(e){o.put(n,e),t(e)})})});t.push(r)}}),t):(t.push.apply(t,i),t):t}}]),e}(),R=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function D(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i=Object.assign({dynamic:!0},i);var n=new M(e,i);return t&&(n.getMediaPlayers=t),i&&!i.dynamic&&(n.processRequest=null),n}var M=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.options=i,this._ids=[]}return R(e,[{key:"getMediaPlayers",value:function(){console.log("Method not defined")}},{key:"makePlayer",value:function(e,t,i,n){var r=this.options&&this.options.pip||null;return new q({name:this.name,node:e,ids:t,scraper:i,pipFunctions:r,opts:n})}},{key:"processRequest",value:function(e){e&&-1===this._ids.indexOf(e)&&this._ids.push(e)}}]),e}();var j=g({request:{method:"GET",url:function(e){return Object(_.f)(e.ext)?e.url:null}},parse:function(e,t){return"string"==typeof e&&(e=n.UrlUtils.parse(e)),Object(_.f)(e.ext)&&t?I(t,e):(e.quality||(e.quality=y.a.DEFAULT_QUALITY_TYPE),"number"==typeof e.size&&(e.size=n.Utils.beautifyFileSize(e.size)),[e])}});var B=D("default",function(){var e=[];if(function(e){return n.Utils.isMatches(e,_.e)}(location.host))return e;for(var t=n.Utils.queryAll("[src]"),i=[],r=0,a=(t=t.filter(function(e){return e.tagName&&!["script","img"].includes(e.tagName.toLocaleLowerCase())}).filter(function(e){return!((t=e.src)&&(m.a.check(t)||m.a.check(t,"requests")));var t})).length;r<a;++r){var o=t[r],s=o.src,l=n.UrlUtils.getMediaType(s);if(void 0!==l&&o.getAttribute("src")){var u=n.UrlUtils.parse(s);s&&s.includes("videoplayback")&&s.includes("mp4")&&(u.ext="mp4"),u.type=l,p.a.isValidData(u)&&(u.filename=b(u.filename,document.title),o=v(o),u.quality=y.a.DEFAULT_QUALITY_TYPE,o?e.push(this.makePlayer(o,[u],j)):i.push(u))}}return i.length&&e.push(this.makePlayer(null,i,j)),this._ids.length&&e.push(this.makePlayer(null,this._ids,j)),e});B.processRequest=function(e){m.a.check(location.href,"download")||(this._ids.some(function(e){return e.url&&e.url.match(/m3u8?/i)})||(e.filename=b(e.filename,document.title),this._ids.push(e)))};var W=B,F=i(6),H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z=void 0,V={"4320p":{label:"8K UHD",value:1600},"3072p":{label:"4K QFHD",value:1400},"2160p":{label:"4K UHD",value:1200},"1440p":{label:"Quad HD",value:1e3},"1080p":{label:"Full HD",value:800},"720p":{label:"HD",value:600},"480p":{label:"Standard",value:500},"360p":{label:"Medium",value:400},"270p":{label:"Small",value:300},"240p":{label:"Small",value:200},"144p":{label:"Mobile",value:100}},G=30,Q={30:0,50:25,60:50},X=[/^https?:\/\/(?:www\.)?youtube(?:-nocookie)?(?:\.googleapis)?\.com\/(?:(?:v)|(?:embed)|(?:e))\/(?!videoseries)([^&?]+)/i,/https?:\/\/(?:www\.)?youtu\.be\/([^#&?]+)/i,/https?:\/\/(?:www\.)?youtube\.com\/.*(?:\?|&)v=([^#&?]+)/i],$=("https:"===location.protocol.toLowerCase()?"https:":"http:")+"//www.youtube.com/watch?v=",Y=n.Utils.isMatches(document.location.href,[/^https?:\/\/(?:www\.)?facebook.com\//i]),K=n.BrFeatures.YT,J={webm:"webm",mp4:"m4a"},Z=["m4a"];function ee(e){for(var t=void 0,i=0;i<X.length;++i)if(t=e.match(X[i]))return t[1];return null}function te(){var e=ee(location.href);if(!e){var t=ne(n.Utils.query(".html5-video-player"));t&&(e=ee(t))}return e||null}function ie(e){return new Promise(function(t,i){return n.Utils.getYoutubeInfo($+e).then(function(e){return function(e,t){if(!t)return console.log("Youtube config invalid"),e([]);var i={},r=[],a=null;n.BrFeatures.SUBTITLES&&(a=function(e,t){var i=e.player_response;if(!i)return null;var r=void 0;try{r="object"===(void 0===i?"undefined":H(i))&&i.captions?i:JSON.parse(i)}catch(e){return null}var a=void 0;try{a=r.captions.playerCaptionsTracklistRenderer.captionTracks}catch(e){return null}if(!a||!a.length)return null;var o=a.filter(function(e){return t.includes(e.languageCode)}),s={},l=[];if(o.forEach(function(e){var t=e.languageCode,i=Object(n.i18n)("subtitles_lang_"+t)||t.toUpperCase(),r=e.baseUrl;e.vssId!=="a."+t&&(s[i]=r,l.push(t))}),o.length>0){["en","vi"].forEach(function(e){if(!l.includes(e)){var t=Object(n.i18n)("subtitles_lang_"+e),i=o[0].baseUrl+"&tlang="+e;s[t]=i}})}return s}(t,["en","vi","ko","ja","fr","ru"]));var o=t.formats.map(function(e){var a=e.quality_label||e.resolution||"",o=a.replace(/([0-9]{3,5}p).*/,"$1"),s=a.replace(/([0-9]{3,5}p\d{0,3}).*/,"$1"),l=e.fps&&Q[e.fps]?e.fps:G;l=l.toString(),o&&V[o]&&(e.quality=V[o].label);var u=V[o]?V[o].value:null;u+=Q[l];var c=e.container,d={ext:e.container,filename:t.title,title:t.title,quality:e.quality,url:e.url,type:n.Utils.getMediaType(e.type,c),resolution:s,sortValues:{qualityValue:u}},h=n.UrlUtils.parse(e.url);return h.host&&(d.altUrl=n.UrlUtils.format(h)),!e.encoding&&e.audioEncoding&&(i[e.container]=i[e.container]||{audioBitrate:0},i[e.container].audioBitrate<e.audioBitrate&&(i[e.container]=e)),e.audioEncoding||r.push(d),d});if(r.forEach(function(e){var t=J[e.ext];if(!i[t]||!i[t].url||!K[t])return e.url=null,void(e.quality=null);var n=e.url;e.url={videoUrl:String(n),audioUrl:String(i[t].url)}}),a){var s=Object.keys(a).map(function(e){var i=n.UrlUtils.parse(a[e]);return i.ext="yt_srt",i.i18n_ext="srt",i.filename=t.title,i.title=t.title,i.quality=e,i.type="subtitles",i.isSubtitles=!0,i});o=o.concat(s)}l=o=o.filter(function(e){return!!e.url&&"audio"!==e.type&&!Z.includes(e.ext)}),u=new Set,o=l.sort(function(e){return"mp4"===e.ext?-1:1}).filter(function(e){var t=e.quality+"_"+e.resolution+"_"+e.ext;if(u.has(t))return!1;if("webm"===e.ext){var i=e.quality+"_"+e.resolution+"_mp4";if(u.has(i))return!1}return u.add(t),!0}),e(o);var l,u}(t.bind(this),e)}).catch(function(e){return i(e)})})}function ne(e){var t=e.querySelector("a.ytp-title-link");return t?t.href:null}var re=g({parse:function(e){return ie(e)}});(z=D("youtube",function(){var e=this,t=[],i=[],r=void 0,a=n.Utils.query('meta[itemprop="isLiveBroadcast"]'),o=n.Utils.query('meta[itemprop="endDate"]');if(a&&"True"===a.content&&!o)return t;if(n.Utils.query("ytd-live-chat-frame:not([hidden])"))return t;if(!n.Utils.query("#player-unavailable:not(.hid)")){r=n.Utils.query(".html5-video-player:not(.unstarted-mode)")||n.Utils.query("#player, #movie_player, #movie_player-html5, #movie_player-flash");var s=n.Utils.queryAll('embed[type="application/x-shockwave-flash"]',r);if(1===s.length&&(s=v(s[0]))&&(r=s),r){r=e.makePlayer(r,[],re);var l=ee(location.href);if(!l){var u=ne(r.node);u&&(l=ee(u))}l&&(r.ids.push(l),i.push(l))}}var c=n.Utils.query("#c4-player, .html5-video-player:not(.unstarted-mode)");if(c){var d=c.dataset;if(c=e.makePlayer(c,[],re),d){var h=d.videoId;h&&(c.ids.push(h),i.push(h))}r||(r=c,c=null)}return n.Utils.queryAll('iframe[src*="youtube"], embed[src*="youtube"]').forEach(function(n){var r=ee(n.src);r&&-1===i.indexOf(r)&&(i.push(r),t.push(e.makePlayer(n,[r],re)))}),Y&&n.Utils.queryAll('a[href*="youtube.com"], a[href*="youtu.be"]').forEach(function(n){var r=ee(decodeURIComponent(n.href));r&&-1===i.indexOf(r)&&(i.push(r),n=null,t.push(e.makePlayer(n,[r],re,{aggressive:!0})))}),c&&c.ids.length&&t.splice(0,0,c),r&&r.ids.length&&t.splice(0,0,r),t.push(e.makePlayer(null,this._ids,re)),t},{pip:{detach:function(e){if(this.node.matches("iframe, embed"))return e(this.node),!0;var t=te();if(!t)return console.warn("Error: can't detach youtube video."),!1;var i="https://www.youtube";i+=".com/embed/"+t+"?showinfo=0&autohide=1&enablejsapi=1";var r=n.Utils.closest(this.node,"video");r.length&&(r=r[0],this._videoNode=r,r.currentTime>0&&(i+="&start="+Math.floor(r.currentTime)),r.ended||(i+="&autoplay=1"),r.pause()),document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden";var a=document.createElement("iframe");F.a.style(a,{position:"fixed",left:0,right:0,top:0,bottom:0,width:"100%",height:"100%","z-index":Number.MAX_SAFE_INTEGER-1}),a.setAttribute("allowfullscreen",!0),a.src=i;var o=document.body.children[0];return o?document.body.insertBefore(a,o):document.body.appendChild(a),this._pipNode=a,!0},restore:function(e){if(this.node.matches("iframe, embed"))return e(this.node);if(this._pipNode){var t=this._pipNode&&this._pipNode.contentWindow,i=t&&t.document.querySelector("video"),n=t&&t.document.querySelector("a.ytp-title-link");if(i&&n)te()!==ee(n.href)?location.href=n.href+"#t="+Math.floor(i.currentTime):this._videoNode&&(this._videoNode.currentTime=i.currentTime,this._videoNode[i.paused?"pause":"play"]());document.body.removeChild(this._pipNode),document.body.style.overflow="auto",document.documentElement.style.overflow="auto"}}}})).getMoviesById=ie,z.processRequest=function(e){"www.youtube.com"===window.location.host&&"/"===window.location.pathname||this._ids.push(e)};var ae=z,oe=[/\/\/(?:player\.)?vimeo\.com(?:\/video)?\/([0-9]+)/i,/\/\/vimeo.com\/couchmode\/.*\/([0-9]+)/i,/\/\/player.vimeo.com\/v[0-9]\/video\/([0-9]+)/i,/\/\/player.vimeo.com\/moog\/([0-9]+)/i],se=/(?:&|\?)clip_id=([0-9]+)(?:&|$)/i,le=("https:"===location.protocol.toLowerCase()?"https:":"http:")+"//player.vimeo.com/video/{{id}}/config";function ue(e){for(var t,i=0;i<oe.length;++i)if((t=e.match(oe[i]))&&t[1])return t[1];return null}function ce(e){return(e.match(se)||[])[1]}var de=g({request:{method:"GET",url:function(e){return e.match(/\/video\/(\d+)\/config(\?|$)/i)?e:le.replace("{{id}}",e).replace("{{location}}",location.href)},headers:function(){return{"X-Savior-Replace-Referer":document.location.href}}},parse:function(e,t){return function(e){var t=[],i=[];try{i=n.Utils.getProp(e,"request.files.progressive")||[]}catch(e){return t}return i.forEach(function(i){t.push({type:"video",title:e.video.title,filename:e.video.title,ext:"mp4",url:i.url,resolution:i.quality,quality:y.a.getVimeoQuality(i.quality)})}),t}(JSON.parse(t))}}),he=D("vimeo",function(){var e=this,t=[],i=[];if(n.Utils.queryAll('iframe[src*="vimeo.com"], param[value*="vimeo.com"], video[src*="vimeo.com"], .player[data-fallback-url]').forEach(function(n){var r=function(e){switch(e.tagName){case"IFRAME":return ue(e.src);case"PARAM":return ce(e.value);case"VIDEO":return ce(e.src);default:return ue(e.getAttribute("data-fallback-url")||"")}}(n);r&&-1===i.indexOf(r)&&(i.push(r),t.push(e.makePlayer(n,[r],de)))}),"vimeo.com"===location.host||"player.vimeo.com"===location.host){var r=n.Utils.query("#videos_gallery li.selected a"),a=ue(r&&r.href||location.href);a&&-1===i.indexOf(a)&&(i.push(a),t.push(e.makePlayer(r,[a],de)))}return t.push(e.makePlayer(null,e._ids,de)),t}),fe=/(\.|^)(facebook|fb).com$/i,pe=/^blob:https?:\/\/(www)?\.?facebook\.com\/[A-z0-9-]+$/,me=["sd_src","hd_src","sd_src_no_ratelimit","hd_src_no_ratelimit"],_e=/"?videoData"?:\s?\[[\s\S]*?\}\]/g,ye=/<title.*>([\s\S]*)<\/title>/gim,ve=/(?:h|s)d_src(?:_no_ratelimit)?:"([^"]+)"+?/g,ge=new Set,we=g({request:{method:"GET",url:function(e){return e}},parse:function(e,t){ge.add(e);var i=e.split("/").filter(function(e){return!!e}),n=i[i.length-1],r=function(e){var t=ye.exec(e);return t=(t=t&&t.length?t[0].replace(ye,"$1"):document.title).trim().replace(/\n/g," ").replace(/^\(\d+\)\s?/,"")}(t),a=t.match(_e);if(a){var o=new RegExp('"?video_id"?:\\s?"{{{ID}}}"'.replace("{{{ID}}}",n),"g"),s=Array.from(a).filter(function(e){return o.test(e)});if(!s.length){if(!location.href.includes("permalink"))return;s=a}var l=void 0,u=void 0,c=void 0,d=s[0].replace(/"?videoData"?:/,"");try{l=JSON.parse(d)[0]}catch(e){if(!(c=d.match(ve)).length)return null;u=c.map(function(e){return e.replace(ve,"$1")})}var h=[];return l&&me.forEach(function(e){l[e]&&h.push(be(l[e],r,e))}),u&&u.length&&u.forEach(function(e){var t="sd_src";c.forEach(function(i){i.includes(e)&&(t=i.includes("hd_")?"hd_src":"sd_src")}),h.push(be(e,r,t))}),h}}});function be(e,t,i){var r=n.UrlUtils.parse(e);return r.type="video",r.title=t||r.title,r.filename=r.title,r.quality=y.a.getFacebookQuality(i),r}function Ee(e){var t=n.UrlUtils.parse(e);return t.pathname.match(/videos\/[a-z.0-9]+\/?[0-9]+\/?/)?t.protocol+"//"+t.host+t.pathname:null}var Se=D("facebook",function(){var e=this,t=[];location.host.match(fe)&&n.Utils.queryAll("video").forEach(function(i){var r=i.src;if(r&&pe.test(r)){var a=function(e){var t=e.parentNode.querySelectorAll('a[href^="/"]');if(t&&/\/videos\/\d+\/?/.test(t.href))return t;var i=n.Utils.nearestParent(e,'[role="article"]');if(i){var r=i.querySelector("a[data-video-id]");if(r)return r.href;var a=i.querySelector('a[target][rel="theater"]');if(a)return a.href;var o=Array.from(i.querySelectorAll('a[href*="videos"]')).map(function(e){return Ee(e.href)}).filter(function(e){return e});if(o.length)return o[0]}var s=n.Utils.nearestParent(e,"#contentArea");if(s){var l=s.querySelector("a[target][href][data-video-id]");return l?l.href:null}return Ee(location.href)}(i),o=n.Utils.nearestParent(i,"div[data-story-id]");a&&!o&&t.push(e.makePlayer(i,[a],we))}});return t}),Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ke=/^([\d\w_-]+\.)*zing\.vn$/,Pe=/tv\.zing\.vn/,Oe=/radio\.zing\.vn/,Ae={"360p":/source:\s?"(?:https?:)?(\/\/\S+)",\n?\s+label:\s?'360p'/,"480p":/source:\s?"(?:https?:)?(\/\/\S+)",\n?\s+label:\s?'480p'/,"720p":/video720\s=\s"(\/\/\S+)";/,"1080p":/video1080\s=\s"(\/\/\S+)";/};function Ce(e){var t=[];if(!e||!e.data||!e.data)return t;return(void 0!==e.data.items?e.data.items:[e.data]).forEach(function(e){var i=n.Utils.flatten(function e(t){return Object.keys(t).map(function(i){var n=Te(t[i]);return"string"===n&&t[i]?{quality:i,url:t[i]}:"object"===n?e(t[i]):null})}(e.source)).filter(function(e){return e&&e.url}),r=Object.keys(e.source).includes("128")?"audio":"video";i.forEach(function(i){var a=n.UrlUtils.parse(i.url);a.type=r,a.title=e.artists_names?e.artists_names+" - "+e.name:e.title,a.filename=b(a.filename,a.title),"audio"===r?(a.ext="mp3",a.quality=y.a.getZingAudioQuality(i.quality),a.resolution=i.quality+"kbps"):(a.ext="mp4",a.quality=y.a.getZingVideoQuality(i.quality),a.resolution=i.quality),a.url=n.Utils.addProtocol(a.url,"https"),t.push(a)})}),t}function xe(e){var t=[];return Object.keys(Ae).map(function(t){return{quality:t,match:e.match(Ae[t])}}).forEach(function(e){if(e.match&&e.match.length>1){var i=n.UrlUtils.parse(e.match[1]),r=((a=n.Utils.query(".box-description h1 strong"))&&a.innerText?a.innerText:document.title).trim().replace("\n"," ");i.type="video",i.title=r,i.quality=y.a.getZingVideoQuality(e.quality),i.url=n.Utils.addProtocol(i.url,"https"),i.resolution=e.quality,i.filename=b(r||i.filename,document.title),t.push(i)}var a}),t}function Ue(e){var t=e.mp3;if(!t)return null;var i=n.UrlUtils.parse(t);i.type="audio";var r=e.artist?e.artist+" - ":"";return i.title=r+(e.title||"").trim(),i.force=!0,i.ext="mp3",i.url=n.Utils.addProtocol(i.url,"https"),i.filename=b(i.filename,i.title),i}function Ne(e){var t=e.source[0];if(!t)return null;var i=n.UrlUtils.parse(t);i.type="audio";var r=e.artist?e.artist+" - ":"";return i.title=r+(e.title||"").trim(),i.force=!0,i.ext="mp3",i.url=n.Utils.addProtocol(i.url,"https"),i.filename=b(i.filename,i.title),i}var Ie=g({request:{method:"GET",headers:function(){return{"X-Savior-Replace-Referer":document.location.href}}},parse:function(e,t){var i=[];if(0===i.length){var n=void 0;try{if(n=JSON.parse(t)){var r=Ce(n);r.length&&(i=i.concat(r))}}catch(e){}}if(window.location.host.match(Pe)&&0===(i=i.concat(xe(t))).length&&t.match(/source:\s?.+m3u8\??/)){var a=window.fetch(window.location.href,{cache:"no-store"}).then(function(e){return e.text()}).then(function(e){return Promise.resolve(xe(e))}).catch(function(e){console.error(e)});i.push(a)}return i}}),Le=D("zingvn",function(){var e=[];if(!window.location.host.match(Oe)){var t=n.Utils.query("#zplayerjs-wrapper > div");e.push(this.makePlayer(t||null,[this._ids]||[],Ie))}if(window.pageComm&&location.host.match(ke)){var i=new Promise(function(e){window.pageComm.send({method:"report",args:[["zmp3HTML5","playlist"]]}).then(function(t){Array.isArray(t)?(t=t.map(Ue).filter(function(e){return e}),e(t)):e([])})});e.push(this.makePlayer(null,[i]));var r=new Promise(function(e){window.pageComm.send({method:"eval",args:['return [].map.call(zmCore("li[id^=\'fnPlayerItem\']"),function(el){return zmCore.data(el,"item")})']}).then(function(t){Array.isArray(t)?(t=t.map(Ne).filter(function(e){return e}),e(t)):e([])})});e.push(this.makePlayer(null,[r]))}return window.location.host.match(Pe)&&window.location.pathname.replace("/","")&&e.push(this.makePlayer(null,[window.location.href]||[],Ie)),e}),qe=/^news\.zing\.vn/i,Re=/<.+?src="(.*?)".+HD/i,De="",Me="h2.video-title",je="h1.the-article-title",Be=g({request:{method:"GET"},parse:function(e,t){var i=[],r=t.match(Re);if(r&&r.length){var a=r[1];if(a){var o=n.UrlUtils.parse(a),s=function(){var e=document.querySelector(Me);if(e)return e.innerText;if(document.querySelector(je))return document.title}();s&&(o.filename=s),o.title=o.filename,o.quality="Standard",o.type="video",i.push(o)}}return i}});var We=D("news.zingvn",function(){var e=[];if(window.location.host.match(qe)){var t=document.querySelector(".player video");t&&(t.id!==De&&(this._ids=[],De=t.id),e.push(this.makePlayer(t,[window.location.href],Be)))}return e}),Fe=/https?:\/\/[^?]+xml\?key.*/,He=/_([0-9]{3,4})\.mp4/,ze=/^([\w\d_-]+\.)*nhaccuatui.com$/,Ve=g({request:{method:"GET",headers:function(){return{"X-Savior-Replace-Cookie":document.cookie+"; touchEnable=true;"}}},parse:function(e,t){var i=w.parsePlaylist(e,t);return i=i.filter(function(e){return"html"!==e.ext}).map(function(e){return e.resolution=Ge(e.url),e.filename=e.title,e})}});function Ge(e){var t=e.match(He);return t&&t[1]?t[1]+"p":"480p"}function Qe(){if("www.nhaccuatui.com"!==location.hostname)return null;var e=n.Utils.query("video#videonctPlayer");if(e)return function(e){var t=e.parentNode;if(t)return!!t.querySelector(".prerollAdv");return!1}(e)?null:e;var t=n.Utils.queryAll("#playerMp3flashPlayer");if(1!==t.length)return null;var i=t[0],r=i.getAttribute("data");return r&&r.match(/flash\/player\.nct/)?i:v(i)}function Xe(){return new Promise(function(e){window.pageComm.send({method:"report",args:[["__data","nctPlayer","curVideoItem"]]}).then(function(t){if(t&&t.highquality&&t.lowquality){var i=[t.highquality,t.location,t.lowquality].filter(function(e){return!!e}).map(function(e){var i,r=n.UrlUtils.parse(e);return r.type="video",r.title=t.title||document.title.replace("Xem",""),r.ext="mp4",r.quality=(i=parseInt(Ge(e).replace("p","")),y.a.getQualityBySize(i)),r.resolution=Ge(r.url),r.force=!0,r});e(i)}else e([])})})}function $e(e){var t=e.location.replace(/^[\n\s]*|[\n\s]*$/gm,"");if(!t)return null;var i=Ye(e.title),r=(e.creator?Ye(e.creator)+" – ":"")+i,a=n.UrlUtils.parse(t);return a.type="audio",a.title=r,a.filename=r,a.force=!0,a.ext="mp3",a}function Ye(e){return e.replace(/^[\n\s]*|[\n\s]*$/gm,"")}var Ke=D("nhaccuatui",function(){var e=this,t=[],i=[],r=[];if(n.Utils.queryAll('meta[content*="flash/xml?key"], param[value*="flash/xml?key"], embed[flashvars*="flash/xml?key"]').forEach(function(e){var t=(e.getAttribute("content")||e.getAttribute("value")||e.getAttribute("flashvars")||"").match(Fe),n=t&&t[0];n&&e&&"meta"!==e.tagName.toLowerCase()&&function(e,t){var n=i.indexOf(e);-1!==n?r[n]||(r[n]=t):(i.push(e),r.push(t))}(n,e)}),i.length&&i.forEach(function(i,n){t.push(e.makePlayer(r[n],[i],Ve))}),window.pageComm&&location.host.match(ze)){var a=[new Promise(function(e){window.pageComm.send({method:"report",args:[["__data","flashPlayer","mp3"]]}).then(function(t){Array.isArray(t)?(t=t.map($e).filter(function(e){return e}),e(t)):e([])})}),Xe()],o=n.Utils.query("#nctPlayer")||null;t.push(e.makePlayer(o,a))}return Qe()&&t.push(this.makePlayer(Qe(),this._ids,Ve)),t}),Je=g({nocache:!0,parse:function(e){return ae.getMoviesById(e)}}),Ze=g({request:{method:"GET"},parse:w.parsePlaylist}),et=D("vietgiaitri",function(){var e=this,t=[],i=(location.href.match(/vietgiaitri\.com\/.*id\.([^.]+)\.vgt/i)||[])[1];if(i){var r=n.Utils.query("object#youtube");t.push(this.makePlayer(r,[i],Je))}return location.host.match(/vietgiaitri\.com/i)&&n.Utils.queryAll('embed[src*="vietgiaitri.com"]').forEach(function(i){var n=w.extract(i);n&&t.push(e.makePlayer(i,[n],Ze))}),t}),tt=/https?:\/\/clip\.vn\/embed\/([0-9a-z_-]+)/i,it=/\/watch\/[^,]+,([0-9a-z_-]+)\/?$/i,nt=/(?:^|&)id=([0-9a-z_-]+)/i,rt=/([^.]+\.)*clip\.vn/i;function at(e){e=e||{};try{var t=void 0;switch(e.tagName){case"IFRAME":t=e.src.match(tt);break;case"PARAM":t=e.getAttribute("value").match(nt);break;default:t=location.pathname.match(it)}return(t||[])[1]}catch(e){return}}var ot=g({request:{method:"POST",url:function(e){return"http://clip.vn/movies/nfo/"+e},params:function(){return{referrer:encodeURIComponent(btoa(location.href)),onsite:"clip"}},headers:function(){return{"X-REFERRER":location.href,"Content-type":"application/x-www-form-urlencoded"}}},parse:function(e,t){var i=n.Utils.xmlParser.parseFromString(t,"text/xml"),r=i.querySelector("ClipInfo title");return n.Utils.queryAll("ClipInfo enclosure",i).map(function(e){var t=e.getAttribute("url"),i=n.UrlUtils.parse(t),a=e.getAttribute("quality");return i.type="video",r&&(i.title=r.textContent),i.quality=y.a.getClipvnQuality(a),i})}}),st=D("clipvn",function(){var e=this,t=[],i=[];function r(n,r){n&&-1===i.indexOf(n)&&(i.push(n),t.push(e.makePlayer(r,[n],ot)))}return location.hostname.match(rt)&&r(at(),n.Utils.query("#player_wrapper object")),n.Utils.queryAll('param[name="flashvars"][value*="clip.vn"], iframe[src*="clip.vn"]').forEach(function(e){r(at(e),e)}),t}),lt=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var ut,ct="embed, object, iframe, video",dt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._nodes=new Set([]),m.a.check(window.location.href,"pip")&&(this.checkPage=n.Utils.noop)}return lt(e,[{key:"_getMediaSize",value:function(e){return e.offsetWidth*e.offsetHeight}},{key:"_isVideoProportion",value:function(e,t){return e>=1*t&&e<=3*t}},{key:"_isLargeEnough",value:function(e){return e>=220}},{key:"_isChildOf",value:function(e,t){for(var i=!1;e&&e.tagName&&"body"!==e.tagName.toLowerCase();){if(t.has(e)){i=!0;break}e=e.parentNode}return i}},{key:"_isBanned",value:function(e){var t=!1,i=e.querySelector("embed");return i&&(t=m.a.check(i)),t||m.a.check(e)}},{key:"_isFullscreenable",value:function(e){var t=!e.matches(ct)&&n.Utils.queryAll(ct,e);return!(!t||!t.reduce(function(e,t){return e||this._isFullscreenable(t)}.bind(this),!1))||(!(!e.matches('embed[allowfullscreen="true"], iframe[allowfullscreen], video')&&!m.a.check(e,"pip-allowfullscreen-false"))||("OBJECT"===e.tagName?!!n.Utils.queryAll('param[value="true"]',e).filter(function(e){return e.name&&"allowfullscreen"===e.name.toLowerCase()}).length:!!(e.offsetParent&&e.src&&e.src.includes("vidio.com/embed"))))}},{key:"isVideoNode",value:function(e){var t=F.a.getEmbedSize(e),i=t.width,n=t.height;return this._isLargeEnough(i,n)&&this._isVideoProportion(i,n)&&this._isFullscreenable(e)&&this._isVideoNodeContainsSource(e)&&!this._isBanned(e)}},{key:"_isVideoNodeContainsSource",value:function(e){return"video"!==e.tagName.toLowerCase()||!(!e.attributes.src&&!e.querySelector("source"))}},{key:"_findVideos",value:function(){if(!m.a.check(location.href,"pip"))for(var e,t=n.Utils.queryAll(ct),i=0,r=t.length;i<r;i++){var a=(e=t[i]).querySelector("embed");this._isChildOf(e,this._nodes)||a&&this._isChildOf(a,this._nodes)||!this.isVideoNode(e)||e.dataset.linkSaviorIgnore||this._nodes.add(e)}}},{key:"markCandidate",value:function(e){}},{key:"checkPage",value:function(e){return this._nodes.clear(),this._nodes=new Set(e),this._findVideos(),Array.from(this._nodes)}}]),e}(),ht=i(51);ut={width:640,height:480},location.host.match(/^(?:[\w\d_-]+\.)*google.com$/)&&document.addEventListener("click",function(e){if(e.target&&e.target.matches("a[x-chrome-pip-url]")){var t=e.target,i=t.getAttribute("x-chrome-pip-url"),r=t.getAttribute("x-chrome-pip-size"),a=t.hasAttribute("x-chrome-keep-size"),o=r&&/^(\d+)x(\d+)/.exec(r),s={url:i,width:(r=o?{width:+o[1],height:+o[2]}:ut).width,height:r.height};a&&(s.isAds=!0),n.BGUtils.sendMessage({requestType:"pip",method:"pipUrl",params:s}),e.preventDefault(),e.stopPropagation()}});var ft=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var pt=i(28),mt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.detector=new dt,this.pipDOM=new ht.a}return ft(e,[{key:"detachPlayerOrNode",value:function(e,t){var i=this.pipDOM.pin(e,t);chrome.extension.inIncognitoContext&&(i.incognito=!0),this.emit("tab_detached",i)}},{key:"restore",value:function(){this.pipDOM.restore(),this.emit("tab_restored",null)}},{key:"isPanelMode",get:function(){return this.pipDOM.isPanelMode}}]),e}();pt(mt.prototype);var _t=new mt,yt=D("pip",function(){var e=[];return _t.detector.checkPage().forEach(function(t){e.push(this.makePlayer(t,[],null))}.bind(this)),e}),vt=g({request:{method:"GET"},parse:function(e,t){return new Promise(function(i,r){var a=[],o=void 0;try{o=JSON.parse(t)}catch(e){return r([])}if(o.http_mp3_128_url){var s=n.UrlUtils.parse(o.http_mp3_128_url),l=e.match(/soundcloud\.com\/i1\/tracks\/(\d+)\//);if(!l||!l.length)return r([]);var u=l[1],c=function(e,t){t||(t=window.location.href),e=e.replace(/[[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}("client_id",e);window.fetch("https://api-v2.soundcloud.com/tracks?ids={{track_id}}&client_id={{client_id}}".replace("{{track_id}}",u).replace("{{client_id}}",c)).then(function(e){return e.json()}).then(function(e){if(!e.length)return r([]);var t=e[0];s.title=t.title,s.quality=y.a.DEFAULT_QUALITY_TYPE,s.type="audio",a.push(s),i(a)}).catch(function(){r([])})}}.bind(this))}}),gt=D("soundcloud",function(){var e=[];return window.location.pathname.replace("/","")&&e.push(this.makePlayer(null,[this._ids],vt)),e}),wt=/w?\.xvideos\.com\/video[0-9]+\//;var bt=g({request:{method:"GET"},parse:function(){return new Promise(function(e){window.pageComm.send({method:"eval",args:["return [html5player.url_high, html5player.url_low]"]}).then(function(t){if(t&&t.length){var i=t.map(function(e){var t=n.UrlUtils.parse(e);return t.type="video",t.title=function(){for(var e=document.querySelector("#main h2").firstChild,t=[];e;)3===e.nodeType&&t.push(e.data),e=e.nextSibling;return t.join("").trim()}()||document.title,t.filename=t.title,t.quality=y.a.getQualityBySize(e.includes("3gp")?240:480),t});e(i)}}).catch(function(e){console.log(e)})})}}),Et=D("xvideos",function(){var e=[];if(location.href.match(wt)&&window.pageComm){var t=n.Utils.query("#html5video");e.push(this.makePlayer(t,[window.location.href],bt))}return e}),St=/xnxx\.com\/video-/;var Tt=g({request:{method:"GET"},parse:function(){return new Promise(function(e){window.pageComm.send({method:"eval",args:["return [html5player.url_high, html5player.url_low]"]}).then(function(t){if(t&&t.length){var i=t.map(function(e){var t=n.UrlUtils.parse(e);return t.type="video",t.title=function(){for(var e=document.querySelector(".infobar > strong").firstChild,t=[];e;)3===e.nodeType&&t.push(e.data),e=e.nextSibling;return t.join("").trim()}()||document.title,t.quality=y.a.getQualityBySize(e.includes("3gp")?240:480),t});e(i)}}).catch(function(e){console.log(e)})})}}),kt=D("xnxx",function(){var e=[];if(location.href.match(St)&&window.pageComm){var t=n.Utils.query("#html5video");e.push(this.makePlayer(t,[window.location.href],Tt))}return e});function Pt(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var Ot=g({request:{method:"GET"},parse:function(e,t){var i=[],r=new Set,a=void 0;try{a=JSON.parse(t)}catch(e){return console.warn("Cannot parse phimmoi response"),i}return function(e){var t=e.medias||[],i=e.mediasBk||[],n=e.mediasBk1||[];return[].concat(Pt(t),Pt(i),Pt(n))}(a).forEach(function(e){var t=e.resolution+"_"+e.type;if(e.url&&!r.has(t)){var a=n.UrlUtils.parse(e);a.url=e.url,a.quality=e.resolution?y.a.getQualityBySize(e.resolution):y.a.DEFAULT_QUALITY_TYPE,a.filename=e.url.split("/").pop(),a.title=document.title.replace(/^(Xem phim)/gi,"").trim(),a.type="video",a.ext=e.type,r.add(t),i.push(a)}}),i}}),At=D("phimmoi",function(){var e=[];return e.push(this.makePlayer(null,[this._ids],Ot)),e}),Ct={kenh14:{mediaNamePattern:/name=kenh14\/(.*)_/,framesSelector:".iframe-wraper iframe",parentSelector:".kbwcli",titleSelector:".kbvi-title",videoIdUrlPattern:/kenh14\/\S+\.mp4/},vtv:{mediaNamePattern:/name=vtv\/(.*)_/,framesSelector:"div.inithd > div",parentSelector:".video-highlight-box, .box-content > .item",titleSelector:".title",videoIdUrlPattern:/vtv\/\S+\.mp4/},tuoitre:{mediaNamePattern:/name=tuoitre\/(.*)_/,framesSelector:".iframe-wraper iframe",parentSelector:".fck",titleSelector:".VideoCMS_Caption > p",videoIdUrlPattern:/tuoitre\/\S+\.mp4/},afamily:{mediaNamePattern:/name=afamily\/(.*)_/,framesSelector:".iframe-wraper iframe",parentSelector:".video-highlight-v3",titleSelector:".title",videoIdUrlPattern:/afamily\/\S+\.mp4/},gamek:{mediaNamePattern:/name=gamek\/(.*)_/,framesSelector:".iframe-wraper iframe",parentSelector:"body",titleSelector:".videofocus-desc h1, .topdetail h1",videoIdUrlPattern:/gamek\/\S+\.mp4/},soha:{mediaNamePattern:/name=soha\/(.*)_/,framesSelector:".iframe-wraper iframe",parentSelector:".video-highlight",titleSelector:"#video-title",videoIdUrlPattern:/sohanews\/\S+\.mp4/},dantri:{mediaNamePattern:/name=dantri\/(.*)_/,framesSelector:"#video-embeb iframe",parentSelector:".video-highlight",titleSelector:"#video-title",videoIdUrlPattern:/dantri\/\S+\.mp4/}},xt={mediaNamePattern:/name=.+\/(.*)_/,framesSelector:".iframe-wraper iframe, #mainplayer_video",parentSelector:".video-highlight",titleSelector:".title, #video-title",videoIdUrlPattern:/\/.+\/\S+\.mp4/},Ut=g({request:{method:"GET"},parse:function(e,t){var i=function(e,t){var i=[],r=void 0;try{r=JSON.parse(t)}catch(e){return console.warn("Cannot parse mediacdn response"),i}if(e.includes("/vtv/")&&r.hls)return[(a=r.hls,new Promise(function(e){fetch(a).then(function(e){return e.text()}).then(function(t){var i=I(t);e(i)}).catch(function(t){console.warn(t),e(null)})}))];var a;return function(e){if(e.html5&&e.html5.length)return e.html5;if(e.mp4)return Array.isArray(e.mp4)?e.mp4:[e.mp4];return[]}(r).forEach(function(e){var t=n.UrlUtils.parse(e),r=function(e){var t=e.match(Nt);return t&&t.length?parseInt(t[1]):null}(e),a=function(e){return e=(e=e.split("/").pop()).replace(Nt,"")}(e);t.quality=r?y.a.getQualityBySize(r):y.a.DEFAULT_QUALITY_TYPE,t.filename=a,t.title=a,t.type="video",r&&Number.isInteger(r)&&(t.resolution=r+"p"),i.push(t)}),i}(e,t);if(i.length){var r=function(e){var t=e.mediaItem,i=e.mediaNamePattern,r=e.framesSelector,a=e.parentSelector,o=e.titleSelector;if(!t.search)return null;var s=t.search.match(i);if(!s)return null;var l=Array.from(document.querySelectorAll(r)),u="vtv"===It?l.find(function(e){return e.parentElement.dataset.vid.includes(s[1])}):l.find(function(e){return e.src&&e.src.includes(s[1])});if(!u)return null;var c=n.Utils.nearestParent(u,a);if(!c||c===document)return null;var d=c.querySelector(o);return d?d.textContent.trim():null}(Object.assign({mediaItem:i[0]},Ct[It]||xt));r||(r=document.title.trim()),i=i.map(function(e){return e.title=r,e.filename=r+(e.resolution?"_"+e.resolution:""),e})}return i}});var Nt=/_([0-9]{3,4})p/;var It=document.location.hostname.split(".").shift(),Lt=D("mediacdn",function(){var e=this,t=[],i=this._ids;if(i&&i.length){var n=Array.from(document.querySelectorAll((Ct[It]||xt).framesSelector));i.forEach(function(i){var r=i.match((Ct[It]||xt).videoIdUrlPattern);if(r){var a="vtv"===It?n.find(function(e){return e.parentElement.dataset.vid.includes(r[0])}):n.find(function(e){return e.src&&e.src.includes(r[0])});a?t.push(e.makePlayer(a,[i],Ut)):t.push(e.makePlayer(null,[i],Ut))}})}return t}),qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rt=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function Dt(e,t){Array.prototype.push.apply(e,t)}function Mt(e){return new Promise(function(t){var i=e.map(function(e){return void 0!==e.promise?e.promise:e});Promise.all(i).then(function(){var e=function(){var e=location.href;if(!f.test(e))return null;e=e.replace(f,"");for(var t=void 0,i=void 0,r=0;r<c.length;++r)if(i=c[r],n.Utils.isMatches(e,i.location)){try{var a=n.Utils.queryAll(i.selector);if(a.length?t=a.shift().textContent:(t=n.Utils.query("title").textContent,i.selector="title"),"title"===i.selector&&(t=t.replace(d,"").replace(h,"")),i.auxSelector){var o=n.Utils.query(i.auxSelector).textContent.trim();o&&(t+=" ("+o+")")}t=t.replace(/\s+/g," ").trim()}catch(e){console.log(e)}if(t)return{title:t,test:i.match}}return e.match(/^fptplay\.net/i)?{title:null,test:function(e){var t=e.pathname.split("/"),i=t.length-1,n=t[i];return"chunklist.m3u8"===n&&i>0&&(n=t[i-1]),n&&(this.title=n),!0}}:null}(),i=[];n.Utils.flatten(Array.from(arguments)).forEach(function(t){t&&(p.a.isValidData(t)||t.force)&&(t.referrer=t.referrer||location.href,!t.title&&e&&e.test(t)&&(t.title=e.title),i.push(t))}),t(i)})})}var jt=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._providers=[W,ae,he,Se,Le,We,Ke,et,st,yt,gt,Et,kt,At,Lt]}return Rt(e,[{key:"processRequest",value:function(e){for(var t=e.name,i=0;i<this._providers.length;++i){var n=this._providers[i];if(n.name===t&&n.processRequest){n.processRequest(e.result);break}}}},{key:"getMedia",value:function(e){var t=e||this._players;if(!t)return new Promise(function(e,t){t([])});var i=[];t.filter(function(e){return Array.isArray(e.ids)&&e.ids.length&&n.Utils.flatten(e.ids).length}).forEach(function(e){Dt(i,e.getMedia())});var r=this;return new Promise(function(e){Mt(i).then(function(t){if(n.BrFeatures.SOUND_ONLY&&t.length){var i=r.createMP3Resources(t);t=t.concat(i);var a=[];n.Utils.splitMediaSourcesByTitle(t).forEach(function(e){a=a.concat(e)}),t=a}e(t)}.bind(this))})}},{key:"createMP3Resources",value:function(e){var t=e.filter(function(e){return"video"===e.type&&!["m3u","m3u8"].includes(e.ext)&&("object"===qt(e.url)&&e.url.audioUrl||"string"==typeof e.url)}),i=[{bitrate:"128kbps",name:"Medium",qualityValue:100},{bitrate:"320kbps",name:"High",qualityValue:200}],r=[];return t.length?(n.Utils.splitMediaSourcesByTitle(t).forEach(function(e){var t=i.map(function(t){var i=function(e,t){var i=parseInt(t),n=[].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(e)),r=e.filter(function(e){return"mp4"===e.ext});r.length&&(n=r);var a=n.filter(function(e){return e.quality&&"full hd"===e.quality.toLowerCase()}),o=n.filter(function(e){return e.quality&&"hd"===e.quality.toLowerCase()}),s=n.filter(function(e){return e.quality&&["normal","medium","standard"].includes(e.quality.toLowerCase())});switch(i){case 320:a.length?n=a:o.length?n=o:s.length&&(n=s);break;case 128:default:s.length?n=s:o.length?n=o:a.length&&(n=a)}var l=n.filter(function(e){return"object"===qt(e.url)&&e.url.audioUrl});l.length&&(n=l);return n[0]}(e,t.bitrate),n=Object.assign({},i);return n.url=n.url.audioUrl||n.url,["m3u8","m3u"].includes(n.ext)&&(n._hls=!0),n.ext="mp3",n.soundOnly=!0,n.quality=t.name,n.resolution=t.bitrate,n.type="audio",n.sortValues={qualityValue:t.qualityValue},n});r=r.concat(t)}),r):r}},{key:"getMediaForPlayer",value:function(e){return Mt(e.getMedia())}},{key:"getMediaPlayers",value:function(){var e=[];return this._providers.forEach(function(t){Dt(e,t.getMediaPlayers())}),this._players=e,e}}]),e}()),Bt=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var Wt=i(28),Ft=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._manager=t,this._timeout=null,this._started=!1,this._paused=!1,this._pollCallback=this._poll.bind(this),this.RECHECK_PERIOD=3e3}return Bt(e,[{key:"_init",value:function(){document.addEventListener("webkitvisibilitychange",this._pollCallback,!1)}},{key:"_getPlayerNodes",value:function(e){for(var t,i=[],n=e.length;t=e[--n];)t.node&&t.ids.length&&i.push(t.node);return i}},{key:"_poll",value:function(){if(clearTimeout(this._timeout),!this._paused&&!document.webkitHidden){var e=this._manager.getMediaPlayers(),t=e.map(function(e){return new Promise(function(t){Promise.all(e.ids).then(function(i){e.ids=[],i&&i.length&&n.Utils.flatten(i).length&&(e.ids=e.ids.concat(i)),t(e)})})});Promise.all(t).then(function(){var t=n.Utils.toArray(arguments),i=this._getPlayerNodes(e);this.emit("media_update",t,i),this._timeout=setTimeout(this._pollCallback,this.RECHECK_PERIOD)}.bind(this))}}},{key:"start",value:function(){this._started?this._paused&&(this._paused=!1,this._poll()):(this._init(),this._poll(),this._started=!0)}},{key:"pause",value:function(){clearTimeout(this._timeout),this._paused=!0}},{key:"destroy",value:function(){clearTimeout(this._timeout),document.removeEventListener("webkitvisibilitychange",this._pollCallback,!1)}}]),e}();Wt(Ft.prototype);var Ht=Ft,zt=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var Vt=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.STYLE={background:"#000000",position:"fixed",left:"0px",top:"0px",right:"0px",bottom:"0px",opacity:.6,zIndex:2147483647},this._init()}return zt(e,[{key:"_init",value:function(){var e=document.createElement("savior:overlay");F.a.style(e,this.STYLE),this._overlay=e,this._warp=document.createDocumentFragment(),this._styleElement=document.createElement("style"),this._styleElement.innerHTML="body { -webkit-filter: blur(3px)!important; }",e.addEventListener("mouseup",this.hide.bind(this),!0),e.addEventListener("mousedown",this.hide.bind(this),!0),this._port=null,this._onConnectCallback=this._onConnect.bind(this),this._onDisconnectCallback=this._onDisconnect.bind(this),chrome.runtime.onConnect.addListener(this._onConnectCallback)}},{key:"_onConnect",value:function(e){this._port=e,"overlay"===e.name&&(this.show(),e.onDisconnect.addListener(this._onDisconnectCallback))}},{key:"_onDisconnect",value:function(){this.hide(),this._port&&this._port.onDisconnect.removeListener(this._onDisconnectCallback),this._port=null}},{key:"hide",value:function(e){this._warp&&(e&&e.stopPropagation&&(e.stopPropagation(),e.preventDefault()),this._warp.appendChild(this._overlay),this._warp.appendChild(this._styleElement))}},{key:"show",value:function(){document.body.appendChild(this._overlay),document.head.appendChild(this._styleElement)}},{key:"destroy",value:function(){this.hide(),this._port&&this._port.onConnect.removeListener(this._onConnectCallback),this._port=null,this._styleElement=null,this._overlay=null,this._warp=null}}]),e}()),Gt=i(17),Qt=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var Xt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.port=Math.floor(Math.random()*Math.pow(2,32)),this.msgId=0,this._promises={},this._initPage(),window.addEventListener("message",this._listener.bind(this))}return Qt(e,[{key:"send",value:function(e){var t=this;return e={data:e,id:this.msgId,port:this.port,type:"coc_crx2page"},new Promise(function(i){t._promises[t.msgId]=i,t.msgId++,window.postMessage(e,location.origin)})}},{key:"_initPage",value:function(){var e=document.head||document.body;if(e){var t=document.createElement("script"),i="("+function(e,t){var i=new Set(["string","number","boolean","undefined"]),n=function(e){try{if(null===e||i.has(typeof e))return e;if(Array.isArray(e))return e.map(n);if("object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype){var t={};return Object.keys(e).forEach(function(i){t[i]=n(e[i])}),t}return null}catch(e){return null}},r={report:function(t,i){Array.isArray(i)?t(n(i.reduce(function(e,t){return e&&e[t]},e))):t(null)},eval:function(e,t){var i=null;try{i=new Function(t).call(this)}catch(e){i=e.toString()}e(n(i))}};e.addEventListener("message",function(i){if(i.origin===location.origin&&i.data&&i.data.port===t&&"coc_crx2page"===i.data.type){var n=i.data.id,a=i.data.data;"method"in a&&a.method in r&&r[a.method].apply(r,[function(i){i={data:i,id:n,port:t,type:"coc_page2crx"},e.postMessage(i,location.origin)}].concat(a.args))}})}.toString()+")(window,"+this.port+")";t.innerText=i,e.appendChild(t),setTimeout(function(){e.removeChild(t)},100)}else console.warn("trying to run pagecomm without target element!")}},{key:"_listener",value:function(e){if(e.origin===location.origin&&e.data&&e.data.port===this.port&&"coc_page2crx"===e.data.type){var t=e.data;try{this._promises[t.id](t.data)}finally{delete this._promises[t.id]}}}}]),e}(),$t=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var Yt=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._callbacks=[],this._data={},this._media2id={}}return $t(e,[{key:"processRequest",value:function(e,t){switch(e){case"created":this._onCreated(t);break;case"erased":console.log("erased download:",t),delete this._data[t];break;case"changed":this._onChange(t)}}},{key:"_sendMessage",value:function(e,t,i){chrome.runtime.sendMessage({requestType:"downloads",method:e,params:t},i)}},{key:"_onCreated",value:function(e){if(e){var t=e.item.id;this._data[t]=e,this._media2id[e.mid]=t}}},{key:"_onChange",value:function(e){var t=this._data[e.id];if(t){var i=t.item;for(var r in e)"id"!==r&&(i[r]=e[r].current);n.Utils.call(this._callbacks,this,t.mid,i,e)}}},{key:"onChange",value:function(e,t){console.assert(-1===e),this._callbacks.push(t)}},{key:"download",value:function(e,t){console.assert(-1===e);var i=this,n=t.id;return new Promise(function(e,r){this._sendMessage("download",t,function(t){var a=t.data;t.success&&"reject"!==t.success?(i._data[a.id]={item:a,mid:n},i._media2id[n]=a.id,e(a)):r(a)})}.bind(this))}},{key:"item",value:function(e,t){console.assert(-1===e);var i=this._media2id[t],n=this._data[i];return n&&n.item}},{key:"pause",value:function(e){this._sendMessage("pause",e)}},{key:"resume",value:function(e){this._sendMessage("resume",e)}},{key:"cancel",value:function(e){this._sendMessage("cancel",e)}},{key:"open",value:function(e){this._sendMessage("open",e)}},{key:"show",value:function(e){this._sendMessage("show",e)}}]),e}()),Kt=i(1),Jt=i(19),Zt=i(16),ei=i(7),ti=i.n(ei),ii=i(18),ni=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var ri=i(28),ai=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._widget=n.Utils.$E("div","downloads"),this._pseudoSelects=new Map,this._node=t,this._mode="select_media",this._downloadingId=-1,this._logShownSent=!1,this._showFirstSelectTime=null,this._userInitiated=!1,this._ready=!1,this._makeAction=void 0,this._rendered=!1,this._hasDownloadLinks=!1,this._isFirstFreeNode=i}return ni(e,[{key:"_init",value:function(e){this._widget=e,this._setPreferredQuality(r.a.get("preferred_quality_level")),this._widget.addEventListener("click",this._onWidgetClick.bind(this),!1),chrome.runtime.onMessage.addListener(function(e){if("downloads"===e.requestType&&"widget_progress"===e.method){var t=e.params;this._getWidgetMedialURLs().includes(t.url)&&t.mime&&(t.mime.includes("video")||t.mime.includes("octet-stream")&&t.filename.match(/\.mp4$/))&&!t.filename.match(/\.mp3$/)&&(t.exists&&(t.playable||"complete"===t.state)?(this._downloadingId=t.id,this._handleProgress(t)):"interrupted"!==t.state&&t.exists||this._changeWidgetMode("select_media"))}}.bind(this))}},{key:"_renderWidget",value:function(){if(!this._rendered){var e=!m.a.check(location.href,"pip");(e=(e=(e=e&&_t.detector.isVideoNode(this._node))||location.host.match(/^([\w\d_-]+\.)*youtube.com$/))&&r.a.get("detach_enabled"))&&_t.detector.markCandidate(this._node),this._widget.innerHTML=ti.a.render(r.a.get("template-widget"),{i18n_download:Object(n.i18n)("popup_download"),i18n_pip_button:Object(n.i18n)("popup_pip_button"),i18n_play_now:Object(n.i18n)("play_now_play_now"),i18n_play_text:Object(n.i18n)("play_now_click_to_play"),i18n_play_not_show:Object(n.i18n)("play_now_do_not_show"),has_pip:e,no_downloads:!this._player||!this._player.ids.length||!n.Utils.flatten(this._player.ids||[]).length}),this._dl=new Zt.a(this._widget),this._dl.setDownloads(new Jt.a),this._rendered=!0,this._init(this._widget)}}},{key:"attach",value:function(e){this._renderWidget();var t=e.firstChild;t?t!==this._widget&&e.replaceChild(this._widget,t):e.appendChild(this._widget),this._updateDownloads(),this._userInitiated=!1}},{key:"_setPreferredQuality",value:function(e){if(e=e||y.a.DEFAULT_QUALITY_LEVEL,!this._userInitiated&&this._preferredQuality!==e){var t=n.Utils.query("#preferred-select",this._widget);t&&(this._preferredQuality=e,t.setAttribute("data-selected-value",e),t.innerText=Object(n.i18n)("popup_preferred_quality_hint")+" "+Object(n.i18n)("ql_"+e.toLowerCase()))}}},{key:"_updateDownloads",value:function(){if(this._player&&this._userInitiated){var e=this._manager._players.filter(function(e){return(e.node===this._node||this._isFirstFreeNode&&null===e.node)&&e.ids.length&&!e.opts.aggressive}.bind(this));if(e.length)this._dl._downloads.setMediaData(this._manager.getMedia(e)).then(function(e){this._showDownloads(e.model,e.updated)}.bind(this));this._userInitiated=!1}else this._setPreferredQuality(r.a.get("preferred_quality_level"))}},{key:"_showDownloads",value:function(e,t){if(t){var i=this._widget,a=e.getMediaCountByTitle(),o=n.Utils.query("#showhide-all",i);if(0===a&&!this._hasDownloadLinks)return i.className="downloads-empty",o.textContent=o.title=Object(n.i18n)("popup_no_media_found"),void Kt.a.log("PageShown",Kt.a.PAGE_CONTENT_NO_MEDIA);i.className=a>1?"downloads-multi":"downloads-single main",a>12&&i.classList.add("scrollable"),o.textContent=Object(n.i18n)("popup_how_many_media_found",[a]),function(e){var t=e._dl.render(r.a.get("template-list"),{i18n_check_label:Object(n.i18n)("popup_check_label"),i18n_check_all:Object(n.i18n)("popup_check_all"),i18n_check_none:Object(n.i18n)("popup_check_none"),i18n_download_selected:Object(n.i18n)("popup_download_selected"),i18n_download:Object(n.i18n)("popup_download"),i18n_wait:Object(n.i18n)("popup_download_starting"),i18n_one_click:Object(n.i18n)("popup_one_click"),i18n_preferred_quality:Object(n.i18n)("popup_preferred_quality"),i18n_no_media_found:Object(n.i18n)("popup_no_media_found"),i18n_download_failed:Object(n.i18n)("popup_download_failed"),i18n_pip_button:Object(n.i18n)("popup_pip_button"),i18n_sound_only:Object(n.i18n)("popup_sound_only"),has_pip:m.a.check(window.location.hostname,"pip")},e._preferredQuality),i=1===t.length?t[0]:null;if(i&&"download"===e._makeAction){var a=n.Utils.query(".j-quality-download:not([hidden])",i);e._download(a).then(function(t){a&&t&&(Kt.a.log("Download",Kt.a.DOWNLOAD_AUTO),e.serverLogDownload(a,{autoselect:1}),e._updateDownloadSelected())})}e._makeAction=void 0}(this),this._updateButtonsStatus(),this._initPseudoSelect()}}},{key:"_updateButtonsStatus",value:function(){if(this._rendered){var e=this._player&&this._player.ids.length&&n.Utils.flatten(this._player.ids).length;this._widget.querySelector(".main-panel")[e?"removeAttribute":"setAttribute"]("hidden",!0);var t=this._widget.querySelector("#downloads");e&&"progress"!==this._mode?t.removeAttribute("hidden"):t.setAttribute("hidden","hidden"),e&&!this._hasDownloadLinks&&(this._hasDownloadLinks=!0)}}},{key:"_initPseudoSelect",value:function(){var e=this,t=n.Utils.queryAll(".j-quality-selector",this._widget);t&&t.length&&(t.forEach(function(t){new ii.a(t);var i=n.Utils.findParent(t,"j-media-scope");e._pseudoSelects.set(i,t)}),1===t.length&&this._showFirstSelectTime&&(this._showFirstSelectTime=!1,t[0].removeAttribute("hidden")),document.body.addEventListener("click",this._hideAllPseudoSelects.bind(this)))}},{key:"_hideAllPseudoSelects",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,r=this._pseudoSelects.values()[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){n.value.setAttribute("hidden",!0)}}catch(e){t=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}}},{key:"_getPseudoSelect",value:function(e){var t=Array.from(this._pseudoSelects.keys()).filter(function(t){return n.Utils.isDescendant(t,e)})[0];return this._pseudoSelects.get(t)}},{key:"_onClick",value:function(e){var t=this,i=this,r=e.target;switch(this.emit("widget_click",e),n.Utils.queryAll(".j-quality-selector:not([hidden])",this._widget).forEach(function(e){n.Utils.isDescendant(e,r)||n.Utils.isDescendant(e.parentNode,r)||e.setAttribute("hidden",!0)}),r.id){case"download-main":case"preferred-select":if(!i._userInitiated){r.setAttribute("disabled",!0);var a="preferred-select"===r.id;i._makeAction=a?"select":"download",i._userInitiated=!0,Kt.a.log("ButtonClicked",a?Kt.a.BUTTON_FAKE_QUALITY:Kt.a.BUTTON_MAIN),r.innerHTML='<span class="file-size"></span>',"preferred-select"===r.id&&null===this._showFirstSelectTime&&(this._showFirstSelectTime=!0),i._updateDownloads()}return;case"showhide-all":var o=n.Utils.query("#downloads",i._widget);if(o){var s=!o.hidden;o.hidden=s,Kt.a.log("ButtonClicked",s?Kt.a.BUTTON_HIDE_DOWNLOADS:Kt.a.BUTTON_SHOW_DOWNLOADS)}return;case"download-selected":return Kt.a.log("ButtonClicked",Kt.a.BUTTON_DOWNLOAD_ALL),n.Utils.queryAll(".j-media-scope.selected",i._widget).forEach(function(e){i._download(n.Utils.query(".j-quality-download:not([hidden])",e)).then(function(e){e&&Kt.a.log("Download",Kt.a.DOWNLOAD_ALL)})}),void i._updateDownloadSelected();case"check-all":return Kt.a.log("ButtonClicked",Kt.a.BUTTON_CHECK_ALL),void i._toggleSelectMedia(n.Utils.queryAll(".j-media-scope",i._widget),!0);case"check-none":return Kt.a.log("ButtonClicked",Kt.a.BUTTON_CHECK_NONE),void i._toggleSelectMedia(n.Utils.queryAll(".j-media-scope",i._widget),!1);case"open-pip":return Kt.a.log("ButtonClicked",Kt.a.BUTTON_DETACH),void _t.detachPlayerOrNode(this._player);case"hide-widget":return Kt.a.log("ButtonClicked",Kt.a.BUTTON_HIDE),i._hideWidget(),void i.emit("hide");case"play-now":return void this._playNow();case"close-play-now-tooltip":var l=this._widget.querySelector(".tooltip-box");l&&(l.classList.remove("tooltip-shown"),Kt.a.log("PlayNow",Kt.a.PLAY_NOW_TOOLTIP_CLOSED))}switch(r.tagName){case"A":var u=r;return"SPAN"===r.tagName.toUpperCase()&&(u=r.parentNode),void i._download(u).then(function(e){e?(Kt.a.log("Download",Kt.a.DOWNLOAD_BUTTON),t.serverLogDownload(u,{autoselect:0}),i._updateDownloadSelected()):(u.setAttribute("disabled",!0),u.innerText="Error")});case"SPAN":var c=r;if(!c.classList.contains("j-quality-download")){var d=this._getPseudoSelect(c);return d.hasAttribute("hidden")?d.removeAttribute("hidden"):d.setAttribute("hidden",!0),!1}return;case"SELECT":return;case"INPUT":if("checkbox"===r.type){if(r.matches("#play-now-not-show-check"))return this._doNotShowTooltipAgain(e.target.checked),!0;var h=n.Utils.findParent(r,"j-media-scope");return h&&i._toggleSelectMedia(h,r.checked),!0}break;case"DIV":return void(r.matches(".quality-label.j-quality")&&this._onSelectChange(e))}return!0}},{key:"_doNotShowTooltipAgain",value:function(e){r.a.set("hide_play_now_tooltip",e),e&&Kt.a.log("PlayNow",Kt.a.PLAY_NOW_TOOLTIP_NOT_SHOW_AGAIN)}},{key:"_onSelectChange",value:function(e){var t=e.target,i=t.getAttribute("data-quality-value").trim(),a=i.split("/")[1];if(r.a.get("prefer_last_quality")&&1===n.Utils.queryAll(".j-media-scope",this._widget).length){var o=y.a.getQualityLevelByQualityType(a);r.a.set("preferred_quality_level",o),r.a.set("preferred_quality:"+o,i)}var s=n.Utils.findParent(t,"j-media-scope"),l=this._getPseudoSelect(t);return l.setAttribute("data-selected-value",i),this._markSelected(t,l),this._dl._applyCurrentValues(s,l),Kt.a.log("VideoQualityChanged",y.a.getVideoQualityIndex(a)),this._updateDownloadSelected(),l.setAttribute("hidden",!0),!1}},{key:"_markSelected",value:function(e,t){n.Utils.queryAll(".quality-label.selected",t).forEach(function(e){return e.classList.remove("selected")}),e.classList.add("selected")}},{key:"_onWidgetClick",value:function(e){if(!this._onClick(e))return e.preventDefault(),e.stopPropagation(),!0}},{key:"_toggleSelectMedia",value:function(e,t){function i(e){e.classList.toggle("selected",t),n.Utils.query('.filename [type="checkbox"]',e).checked=t}Array.isArray(e)?e.forEach(i):i(e),this._updateDownloadSelected()}},{key:"_updateDownloadSelected",value:function(){n.Utils.queryAll(".j-media-scope.selected",this._widget).some(function(e){if(n.Utils.query(".j-quality-download:not([hidden]):not(.j-disabled)",e))return!0})}},{key:"_getMetricsParams",value:function(e,t){return this._dl.getMetricsParams(e,t)}},{key:"_download",value:function(e){var t=this;return this._dl.download(e).then(function(i){return i&&t.emit("download",e.dataset.quality),Promise.resolve(i)})}},{key:"_hideWidget",value:function(){this._widget.setAttribute("hidden","hidden")}},{key:"_handleProgress",value:function(e){var t=0;if("select_media"===this._mode&&(this._changeWidgetMode("progress"),this._logShownSent||(Kt.a.log("PlayNow",Kt.a.PLAY_NOW_SHOWN),this.emit("playnow_shown"))),"complete"!==e.state){var i=(e.bytesReceived/e.totalBytes*100).toFixed(0);i<0&&(i=0),t=i+"%"}else t="100%";var n=this._widget.querySelector(".progress-box .percent");n&&(n.innerText=t);var r=this._widget.querySelector(".progress-bar .bar");r&&(r.style.width=t)}},{key:"_playNow",value:function(){-1!==this._downloadingId&&(chrome.runtime.sendMessage({method:"play",requestType:"downloads",params:this._downloadingId}),this._pauseMainVideo(),Kt.a.log("PlayNow",Kt.a.PLAY_NOW_WIDGET_CLICKED))}},{key:"_pauseMainVideo",value:function(){var e=this._node.matches("video")?this._node:this._node.querySelector("video");e&&e.pause()}},{key:"_changeWidgetMode",value:function(e){this._mode!==e&&(this._mode=e,this._updateUIMode(this._mode),Wi._controls.playNowBottomTooltip&&("progress"===this._mode?Wi._controls.playNowBottomTooltip.show(this._playNow.bind(this)):Wi._controls.playNowBottomTooltip.hide()))}},{key:"_updateUIMode",value:function(e){var t=this._widget.querySelector(".main-panel"),i=this._widget.querySelector(".play-and-progress-box"),n=this._widget.querySelector("#downloads"),a=this._widget.querySelector(".progress-bar .bar"),o=this._widget.querySelector(".tooltip-box");switch(e){case"select_media":i.setAttribute("hidden","hidden"),t.removeAttribute("hidden"),n.removeAttribute("hidden"),o.classList.remove("tooltip-shown"),this._widget.classList.remove("adaptive-progress");break;case"progress":if(a.style.width=0,t.setAttribute("hidden","hidden"),n.setAttribute("hidden","hidden"),i.removeAttribute("hidden"),this._widget.classList.add("adaptive-progress"),!r.a.get("hide_play_now_tooltip")){setTimeout(function(){o.classList.add("tooltip-shown"),Kt.a.log("PlayNow",Kt.a.PLAY_NOW_TOOLTIP_SHOWN)}.bind(this),500)}}}},{key:"_getWidgetMedialURLs",value:function(){var e=[];try{e=this._dl._downloads.data.map(function(e){return e.url})}catch(e){console.warn("Looks like widget media has diff structure",e)}return e}},{key:"setMediaData",value:function(e,t){this._manager=e,this._player=t,null!==this._widget.parentNode&&!this._widget.parentNode.hidden&&this._hasDownloadLinks||(this._ready=!0,this._updateDownloads(),this._updateButtonsStatus())}},{key:"isReady",value:function(){return this._ready}},{key:"getWidgetRect",value:function(){var e=this._widget;return e?e.getBoundingClientRect():null}},{key:"serverLogDownload",value:function(e,t){t=Object.assign(t,this._getMetricsParams(e)),Kt.a.serverLog("Download",t)}},{key:"getWidgetPlayerName",value:function(){return this._player.name}}]),e}();ri(ai.prototype);var oi=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var si=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.node=null,this.isShown=!1,this.playCallback=null}return oi(e,[{key:"init",value:function(){if(!this.node){var e=document.createElement("div");e.innerHTML=ti.a.render(r.a.get("template-tooltip-play-now-bottom"),{i18n_play_now:Object(n.i18n)("play_now_play_now"),i18n_play_text:Object(n.i18n)("play_now_click_to_play"),i18n_play_not_show:Object(n.i18n)("play_now_do_not_show")}),this.node=e.firstElementChild,this._addListeners(),chrome.runtime.onMessage.addListener(function(e){"widget"===e.requestType&&"new_download"===e.method&&this._processNewDownload()}.bind(this))}}},{key:"_addListeners",value:function(){this.node.addEventListener("click",function(e){switch(e.target.id){case"close-play-now-tooltip-bottom":this.hide();break;case"play-now-not-show-check-bottom":var t=e.target.checked;r.a.set("hide_play_now_tooltip_bottom",t),t&&Kt.a.log("PlayNow",Kt.a.PLAY_NOW_TOOLTIP_BOTTOM_NOT_SHOW_AGAIN);break;default:e.target.matches('label[for="play-now-not-show-check-bottom"]')||(this._playVideo(),this.hide())}}.bind(this))}},{key:"_processNewDownload",value:function(){this.isShown&&this.hide()}},{key:"attach",value:function(e){e.appendChild(this.node),setTimeout(function(){this.node.removeAttribute("hidden")}.bind(this),0)}},{key:"show",value:function(e){r.a.get("hide_play_now_tooltip_bottom")||chrome.extension.inIncognitoContext||(this.node.classList.add("tooltip-shown"),this.isShown=!0,this._notifyBgScript(),"function"==typeof e&&(this.playCallback=e),Kt.a.log("PlayNow",Kt.a.PLAY_NOW_TOOLTIP_BOTTOM_SHOWN))}},{key:"_playVideo",value:function(){"function"==typeof this.playCallback&&this.playCallback()}},{key:"_notifyBgScript",value:function(){chrome.runtime.sendMessage({requestType:"downloads",method:"bottom_tooltip_shown"})}},{key:"hide",value:function(){this.isShown&&(this.node.classList.remove("tooltip-shown"),this.isShown=!1,Kt.a.log("PlayNow",Kt.a.PLAY_NOW_TOOLTIP_BOTTOM_CLOSED))}}]),e}(),li=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var ui=1200,ci=50,di=26;function hi(e,t){for(t=t.parentNode;t&&t!==e;)t=t.parentNode;return!!t}function fi(e){try{if(e.matches("object, embed")){var t=e.parentNode&&e.parentNode.matches("object")?e.parentNode:e.querySelector("embed");t&&t.offsetHeight>e.offsetHeight&&(e=t)}var i=e.ownerDocument.defaultView,n=function(e,t){for(;t&&t!==document;){var i=e.getComputedStyle(t);if(i&&"fixed"===i.getPropertyValue("position"))return"fixed";t=t.parentNode}return"absolute"}(i,e),r=e.getBoundingClientRect(),a=r.top,o=r.left;return"fixed"!==n&&(a+=i.pageYOffset,o+=i.pageXOffset),e.matches("video")&&e.controls&&e.offsetHeight<35&&(o+=5,a=a+e.offsetHeight-35),F.a.getOffset(e).top<=di&&(a+=di),{position:n,top:a+"px",left:o+"px",height:r.height+"px",width:r.width+"px"}}catch(t){return console.trace(t,e),null}}function pi(e){var t=n.Utils.$E("div","base overlay");t.innerHTML="&nbsp;",t.classList.add("hidden");var i={hide:!0,node:null,forced:!1};function a(){t.classList.contains("hidden")&&Kt.a.log("PageShown",Kt.a.PAGE_CONTENT_SHOW_CONTROLS),setTimeout(function(){t.classList.remove("hidden")},0)}function o(){setTimeout(function(){if(i.hide){var e=n.Utils.query(".downloads-multi #downloads",t);e&&(e.hidden=!0),t.classList.add("hidden")}},ui)}function s(){if(i.node){var e="",n=fi(i.node);Object.keys(n).forEach(function(t){e+=t+":"+n[t]+";"}),t.setAttribute("style",e),function(e,t){var i=t.clientWidth;if(!e)return;i<470?i<370?e.classList.add("adaptive","adaptive-small"):(e.classList.remove("adaptive-small"),e.classList.add("adaptive")):e.classList.remove("adaptive","adaptive-small")}(t,i.node)}}function l(){n.Utils.isFullscreen()&&(i.hide=!0,o())}window.addEventListener("resize",s),document.addEventListener("webkitfullscreenchange",l);var u=function(e){var t=n.Utils.debounce(e.onFocus.bind(this),ci,!1);function i(i){var n,r=e.getTarget(i.target);if(r)return t(r,(n=i.type,-1!==["mouseenter","mouseover","touchstart","touchmove"].indexOf(n))),!0}var r={mouseenter:i,mouseleave:i},a=Object.keys(r),o=void 0;function s(e){var t=r[e.type];t&&(null!==o&&(o=e),t(e)&&(e.preventDefault(),e.stopPropagation()))}return{emitLastEvent:function(){var e=o&&r[o.type];e&&e(o),o=null},attach:function(e){for(var t=a.length-1;t>=0;t--)e.addEventListener(a[t],s,!0)},detach:function(e){for(var t=a.length-1;t>=0;t--)e.removeEventListener(a[t],s,!0)}}}({onFocus:function(e,n){if(!i.forced){var l=void 0;if(!n&&(l=function(e){if(e){for(var t=e.parentNode;t;)t=(e=t).parentNode;return e.activeElement}}(t))&&l.matches("select")){if("o"===e)return;l.blur()}if(!n||!r.a.get("on_page_buttons"))return i.hide=!0,void o();if(i.hide=!1,"o"!==e){i.node=e.node;var u=e.widget;u&&u.isReady()&&(e.node.offsetParent?(u.attach(t),s(),a()):console.info("%cWidget will not be shown because observed node nas no offsetParent","color:gray;"))}}},getTarget:function(i){return i?i===t?"o":e.findEntry(i):i}});return u.attach(t),u.attach(document),{attach:function(e){e.appendChild(t),u.emitLastEvent()},destroy:function(){u.detach(document),u.detach(t),window.removeEventListener("resize",s),document.removeEventListener("webkitfullscreenchange",l)},forceShow:function(n){var r=e.findEntry(n);return!(!r||!r.widget.isReady())&&(i.hide=!1,i.node=n,i.forced=!0,r.widget.attach(t),s(),a(),r.widget)},cancelForced:function(){i.hide=!0,i.forced=!1,i.node=null,o()}}}var mi=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.reset(),this.nodeWithoutPlayer=null}return li(e,[{key:"reset",value:function(){this._nodesToMedia=new Map}},{key:"findEntry",value:function(e,t){if(t)return this._nodesToMedia.get(e);for(var i=this._nodesToMedia.entries(),n=i.next();!n.done;n=i.next())if(n.value[0]===e||hi(n.value[0],e)||n.value[1].coverNodesSet&&n.value[1].coverNodesSet.has(e))return{node:n.value[0],widget:n.value[1].widget};return null}},{key:"setMediaPlayers",value:function(e,t){var i=0,n=[];t=this._removeEmptyPlayers(t),t=this._overlayCase(t);var r=this._getNotPipNodes(t);(t=this._filterDescendant(t,r)).forEach(function(t){var r=t.node;if(r){t.ids.length||this.nodeWithoutPlayer&&this._isNodeStillExist(this.nodeWithoutPlayer)||(this.nodeWithoutPlayer=r),this._nodesToMedia.forEach(function(e,t){r!==t&&(t.contains(r)||r.contains(t))&&this._nodesToMedia.delete(t)}.bind(this));var a=this._nodesToMedia.get(r),o=a?a.widget:null,s=this._getTopCoverNodesSet(r);o?s&&s.size&&(a.coverNodesSet=s):(o=new ai(r,r===this.nodeWithoutPlayer),this._nodesToMedia.set(r,{widget:o,coverNodeSet:s}),++i),o.setMediaData(e,t)}else t.ids.length&&n.push(t)}.bind(this));var a=this._nodesToMedia.get(this.nodeWithoutPlayer);return a=a?a.widget:null,this.nodeWithoutPlayer&&a&&n.forEach(function(t){var i=a.getWidgetPlayerName();(t.name===i||"pip"===i&&!t.opts.aggressive)&&(t.node=t.node?t.node:this.nodeWithoutPlayer,a.setMediaData(e,t))}.bind(this)),!!i}},{key:"_removeEmptyPlayers",value:function(e){return e[0].filter(function(e){return e.node||e.ids.length&&n.Utils.flatten(e.ids).length})}},{key:"_getNotPipNodes",value:function(e){return e.filter(function(e){return"pip"!==e.name&&e.node}).map(function(e){return e.node})}},{key:"_filterDescendant",value:function(e,t){return e.filter(function(e){var i=e.node;return!("pip"===e.name&&(-1!==t.indexOf(i)||this._checkDescendant(t,i)))}.bind(this))}},{key:"_checkDescendant",value:function(e,t){var i=!1;return e.forEach(function(e){(e.contains(t)||t.contains(e))&&(i=!0)}),i}},{key:"_getTopCoverNodesSet",value:function(e){if("www.facebook.com"===window.location.hostname)return null;var t=new Set,i=e.getBoundingClientRect(),n=i.width,r=i.height;return[{x:i.left+n/4,y:i.bottom-r/4},{x:i.left+n/4,y:i.bottom-.75*r},{x:i.left+.75*n,y:i.bottom-.75*r}].forEach(function(i){var a=document.elementFromPoint(i.x,i.y);if(a){var o=a.clientWidth,s=a.clientHeight,l="video"!==a.tagName.toLowerCase();a!==e&&l&&o/n<1.1&&s/r<1.1&&t.add(a)}}),t}},{key:"_overlayCase",value:function(e){var t=[];return e.forEach(function(e){var i=e.node;i&&(i.parentNode instanceof Node&&i.parentNode.matches("object")&&(i=i.parentNode),(location.host.match(/^([\w\d_-]+\.)*fptplay.net$/)&&i.matches("object")||location.host.match(/^([\w\d_-]+\.)*vnexpress.net$/)&&i.matches("video#media-video, video.video-js")||location.host.match(/^([\w\d_-]+\.)*nhaccuatui.com$/)&&i.matches("video#videonctPlayer"))&&(e.node=i.parentNode)),t.push(e)}),t}},{key:"_isNodeStillExist",value:function(e){for(var t=e,i=!1,n=void 0;n=t.parentNode;){if(n===document){i=!0;break}t=n}return i}}]),e}();function _i(e){var t=new mi,i=pi(t),r=void 0,a=new si;return{destroy:function(){i&&(i.destroy(),i=null),r&&(e.removeChild(r.element),r=null),t.reset()},setMediaPlayers:function(o,s){t.setMediaPlayers(o,s)&&!r&&(r=function(e){e=e||{};var t=n.Utils.$E("div");t.style.position="absolute",t.style.top="0";var i,r=((i=t).createShadowRoot||i.webkitCreateShadowRoot).call(i),a=n.Utils.$E("style"),o="";(e.styles||chrome.runtime.getManifest().web_accessible_resources||[]).forEach(function(e){e.endsWith(".css")&&(o+='@import "'+chrome.runtime.getURL(e)+'";\n')}),a.innerHTML=o,r.appendChild(a);var s=n.Utils.$E("div","body");return r.appendChild(s),{element:t,shadowElement:s}}(),e.appendChild(r.element),i.attach(r.shadowElement),n.BrFeatures.PLAY_NOW_BOTTOM_TOOLTIP&&(a.init(),a.attach(r.shadowElement)))},switchForceHide:function(e){void 0!==e&&(r.element.style.display=e?"none":"block")},playNowBottomTooltip:n.BrFeatures.PLAY_NOW_BOTTOM_TOOLTIP?a:null}}var yi=n.Utils.query.bind(n.Utils),vi=n.Utils.getNodePropOrEmptyString.bind(n.Utils),gi=function(e,t,i,n,r){this._node=t,this._docId=n,this._index=r,this._data=this._extractData(t,i),this._validateAndSetDataType(e),this._attachClickHandler()};gi.prototype={TITLE_SELECTOR:"h3 a",VISIBLE_URL_SELECTOR:"cite",LINK_SELECTOR:"h3 a:not([id])",DESC_SELECTOR:".st",_extractData:function(e,t){var i=yi(this.TITLE_SELECTOR,e),n=yi(this.VISIBLE_URL_SELECTOR,e),r=yi(this.DESC_SELECTOR,e),a=yi(this.LINK_SELECTOR,e),o={url:vi(a,"href"),visibleUrl:vi(n,"textContent"),position:t,title:vi(i,"textContent"),description:vi(r,"textContent"),addRawContent:""},s=this._findRichInfo();return s.length&&(o.extensions=s),o},_validateAndSetDataType:function(e){this._isDataValid(this._data)?this._data.type=e:this._data.type=this._guessType()},_isDataValid:function(e){return Boolean(e.title&&e.visibleUrl&&e.url&&e.description)},_attachClickHandler:function(){this._clickHandler=this._onClick.bind(this),this._node.addEventListener("click",this._clickHandler,!0)},_onClick:function(e){var t=n.Utils.nearestParent(e.target,"a");if(t&&t.nodeType===Node.ELEMENT_NODE&&!t.getAttribute("href").trim().match(/^(#|javascript:)/)){var i=t.dataset.href||t.href||this.data.url||"",r=t.querySelector("g-img > img[title]");r&&(i=r.title),Mi.triggeResultClicked(),this._reportClick(i)}return!0},_reportClick:function(e){Kt.a.log("SerpClickData",{serpId:this._docId,itemIndex:this._index,timestamp:Date.now(),url:e})},_reportClickConsole:function(e){console.log("Click reported:\n%cserpId: %c%s\n%citem index: %c%s\n%curl: %c%s","font-weight:bold","font-weight:normal",this._docId,"font-weight:bold","font-weight:normal",this._index,"font-weight:bold","font-weight:normal",e)},_guessType:function(){return this._node.matches(".g.kno-kp.mnr-c.g-blk")?"people_also_ask":this._node.matches(".g.mnr-c.g-blk")?this._node.querySelector(".g.mnr-c.g-blk .kp-header")?"featured_video":"featured_snippet":"unknown"},destroy:function(){this._node.removeEventListener("click",this._clickHandler),this._node=null,this._data=null},get data(){return this._data},renderToConsole:function(){var e=this.data.type;"top-ad"===e||"bottom-ad"===e?console.log("%d. %c%s%c %s",this._index,"font-size:16px;font-family:arial,sans-serif;padding: 0 3px;background-color:#efc439;color:#fff;",this.data.type,"font-size:18px;font-family:arial,sans-serif;color:#1a0dab;",this.data.title):console.log("%d. [%s] %c%s",this._index,e,"color:#1a0dab; font-size:18px;font-family:arial,sans-serif;",this.data.title),console.groupCollapsed(this.data.visibleUrl),console.log("%curl: %c%s","font-weight:bold;","font-weight:normal",this.data.url),console.log("%cpos: %c%d","font-weight:bold;","font-weight:normal",this.data.position),this.data.addRawContent&&console.log("%cadditional content: %c%s","font-weight:bold;","font-weight:normal",this.data.addRawContent),console.groupEnd(this.data.visibleUrl),console.log("%c%s\n\n","color:#545454; font-size:13px; font-family:arial,sans-serif;",this.data.description)},_findRichInfo:function(){var e=[],t=this._node.querySelector(".slp.f");t&&t.innerText&&e.push({key:"org_rch_t",value:t.innerText.trim()});var i=this._node.querySelector("g-img");if(i){var n=i.parentNode,r=n.innerText;if(!r){var a=n.querySelector("img");r=a&&a.alt?a.alt:"true"}e.push({key:"org_rch_i",value:r.trim()})}var o=this._node.querySelector(".st > .f > .fl");if(o){var s=o.parentNode;s.innerText&&e.push({key:"org_rch_l",value:s.innerText.trim()})}return e}};var wi=gi,bi=function(){wi.apply(this,arguments)};bi.prototype={__proto__:wi.prototype,DESC_SELECTOR:".ads-creative",LINK_SELECTOR:"h3 a:last-child",NOT_RAW_CONTENT_SELECTOR:"h3, .ads-visurl, .ads-creative",TITLE_SELECTOR:"h3 a:last-child",_extractAdditionalContent:function(){var e=this,t="";return Array.from(this._node.children).forEach(function(i){i.matches(e.NOT_RAW_CONTENT_SELECTOR)||(t+=i.outerHTML+"\n")}),t},_extractData:function(){var e=wi.prototype._extractData.apply(this,arguments),t=this._extractAdditionalContent();return e.addRawContent=t,e}};var Ei=bi,Si=n.Utils.query.bind(n.Utils),Ti=n.Utils.getNodePropOrEmptyString.bind(n.Utils),ki=function(){wi.apply(this,arguments)};ki.prototype={__proto__:wi.prototype,IMAGE_NODE_SELECTOR:"#imagebox_bigimages",IMAGE_TITLE:"h3 > a",SEARCH_BLOCKS_SELECTOR:"#ires .g",_validateAndSetDataType:function(e){if(this._node.matches(this.IMAGE_NODE_SELECTOR)){var t=Si(this.IMAGE_TITLE,this._node);this._data.type=e,this._data.title=Ti(t,"textContent"),this._data.url=Ti(t,"href"),this._data.extensions=this._extractImageTitles()}else this._data.type="unknown"},_extractImageTitles:function(){return Array.from(this._node.querySelectorAll("img")).filter(function(e){return e.title}).map(function(e){return{key:"img_bl_i_t",value:e.title}})}};var Pi=ki,Oi=n.Utils.getNodePropOrEmptyString.bind(n.Utils),Ai=function(){wi.apply(this,arguments)};Ai.prototype={__proto__:wi.prototype,LINK_SELECTOR:'a[tabindex="0"]',LINK_MAP:"#lu_map",INFO_BOX_HEADING:'[role="heading"] [data-original-name]',_validateAndSetDataType:function(e){var t=this._node.querySelector(this.LINK_MAP);if(t){var i=t.parentNode;this._data.url=Oi(i,"href"),this._data.type=e}else{this._data.type="info_box";var n=this._node.querySelector(this.INFO_BOX_HEADING);n&&(this._data.description=n.innerText);var r=this._node.innerHTML.match(/(<span\s?[^>]*>.+?<\/span>)/gi);if(r&&r.length){var a=r.map(function(e){return e.replace(/<\s*(\w+).*?>/gi,"<$1>")}).join("\n");a.length>1e4&&(a=a.slice(0,1e4)),this._data.addRawContent=a}}}};var Ci={"top-ad":Ei,"bottom-ad":Ei,image:Pi,"poi-serp":Ai,"poi-side":Ai},xi=function(e,t,i,n,r){return new(Ci[e]||wi)(e,t,i,n,r)},Ui=n.Utils.query.bind(n.Utils),Ni=n.Utils.queryAll.bind(n.Utils);function Ii(e){var t=n.Utils.toArray(arguments);return t.shift(),function(i){return i[e].apply(i,t)}}var Li=function(){this._items=[],this._isReported=!1,this._scrape()};Li.VERSION=6,Li.prototype={ITEMS_PER_PAGE:10,NOT_SERP_NODES_SELECTOR:"hr",IMAGE_NODE_SELECTOR:"#imagebox_bigimages",SEARCH_BLOCKS_SELECTOR:"#ires .g",SEARCH_BLOCKS_FILTER_SELECTOR:".g .g",POI_SERP_SELECTOR:"#rso > div > div[data-hveid] > div[jsl]",POI_SIDE_SELECTOR:"#rhs_block > div",SPELL_CHECKER_SELECTOR:"#fprs .spell",OTHER_BLOCKS_SELECTORS:[".commercial-unit-desktop-top","#rso g-section-with-header[data-hveid]","#extabar g-scrolling-carousel"],_addItem:function(e,t,i){var n=this._items.length;this._items.push(new xi(e,t,i,this._docId,n))},_scrapeAds:function(e){var t=this,i=Ni({"top-ad":"#tads > ol > li","bottom-ad":"#bottomads ol >li"}[e]);return i.forEach(function(i,n){t._addItem(e,i,n)}),i.length},_scrapeSER:function(e,t){var i=this,r=n.Utils.toArray(e.children).filter(function(e){return e.nodeType===Node.ELEMENT_NODE});return r.forEach(function(e,n){i._addItem("organic",e,t+n)}),r.length},_scrapeResults:function(){var e=this,t=0;return Ni(this.SEARCH_BLOCKS_SELECTOR+", "+this.POI_SERP_SELECTOR).filter(function(t){return!t.matches(e.SEARCH_BLOCKS_FILTER_SELECTOR)}).forEach(function(i){if(""!==i.textContent.trim()&&!i.matches(e.NOT_SERP_NODES_SELECTOR)){var n=i.matches(".srg")?i:i.querySelector(".srg");n?t+=e._scrapeSER(n,t):i.matches(e.IMAGE_NODE_SELECTOR)?e._addItem("image",i,t++):i.matches(e.POI_SERP_SELECTOR)?e._addItem("poi-serp",i,t++):e._addItem("organic",i,t++)}}),t},_generateDocId:function(){return Date.now().toString(32)+"-"+Math.random().toString(32).slice(2)},_scrapeSidePOI:function(){var e=this,t=Ni(this.POI_SIDE_SELECTOR);t&&t.length&&t.forEach(function(t){e._addItem("poi-side",t,e._items.length)})},_scrapeSpellChecker:function(){Ui(this.SPELL_CHECKER_SELECTOR)&&this._putOtherBlock({key:"spell_check",value:"1"})},_scrapeOthers:function(){var e=this.OTHER_BLOCKS_SELECTORS.filter(function(e){var t=Ni(e);return t&&t.length}).map(function(e){return{key:"other_bl",value:e}});this._putOtherBlock(e)},_putOtherBlock:function(e){this._others=this._others||[],Array.isArray(e)?this._others=this._others.concat(e):this._others.push(e)},get _q(){function e(e){return e.offsetWidth&&e.offsetHeight}var t=Ui(".spell_orig b");if(t&&e(t))return t.textContent.trim();var i=Ui("a.spell_orig");return i&&i.href&&e(i)||(i=Ui(".qs")),i&&e(i)&&i.href?n.Utils.g.getSearchParams(i.href).q:null},_parsePage:function(){var e=Ui("#nav .cur");return e?parseInt(e.textContent.trim()):1},_scrape:function(){this._docId=this._generateDocId(),this._s=(this._parsePage()-1)*this.ITEMS_PER_PAGE,this._scrapeAds("top-ad"),this._scrapeResults(),this._scrapeAds("bottom-ad"),this._scrapeSidePOI(),this._scrapeSpellChecker(),this._scrapeOthers()},getSERPData:function(){var e,t={type:"gsearch",id:this._docId,domain:window.location.href,referer:this._extractReferrer(),searchQuery:this._q,searchStart:this._s,timestamp:Date.now(),items:this._items.map((e="data",function(t){return t[e]})),version:Li.VERSION};if(n.BrFeatures.SERP_ADD_STRUCTURES){if(!n.BrFeatures.SERP_ADD_INNER_STRUCTURES){var i=this._extractExtensions(this._items);i&&i.length&&(t.extensions=(t.extensions||[]).concat(i))}this._others&&this._others.length&&(t.extensions=(t.extensions||[]).concat(this._others))}else this._removeExtensions(this._items);return t},_extractReferrer:function(){var e=document.location.search,t=document.referrer;return this._isFromIndexPage?"g_index":/[&?]start=\d/gi.test(e)&&/www\.google\./.test(t)?"g_serp":t||(/[&?]sourceid=chrome&?/gi.test(e)?"omnibox":"unknown")},_extractExtensions:function(e){return e.reduce(function(e,t){return t._data.extensions&&(e=e.concat(t._data.extensions),delete t._data.extensions),e},[])},_removeExtensions:function(e){e.forEach(function(e){e._data.extensions&&delete e._data.extensions})},_metricsReport:function(){Kt.a.log("SerpData",this.getSERPData())},_consoleReport:function(){console.log("%cSerp Id: %c%s","font-size: 18px;font-weight:bold","font-size: 18px;font-weight:normal",this._docId),console.log("%cQuery: %c%s","font-size: 18px;font-weight:bold","font-size: 18px;font-weight:normal",this._q),console.log("%cStart: %c%s","font-size: 18px;font-weight:bold","font-size: 18px;font-weight:normal",this._s),this._items.forEach(Ii("renderToConsole"))},isSameSearchAs:function(e){return e&&e.q.trim()===this._q.trim()&&e.s==this._s},report:function(e){this._isFromIndexPage=e,this._isReported||(this._isReported=!0,this._metricsReport())},destroy:function(){this._items.forEach(Ii("destroy"))}};var qi=Li,Ri=n.Utils.query.bind(n.Utils),Di=function(){n.Utils.g.isSERPHost(location.host)&&(this._lastQs=null,this._currentQParams=n.Utils.g.getSearchParams(location.href),this._isLastWasIndex=this._isIndexPage,window.addEventListener("popstate",this._onPopState.bind(this)),window.addEventListener("hashchange",this._onPopState.bind(this)),this._startPolling())};Di.prototype={POLLING_INTERVAL:200,DELAY_BEFORE_SCRAPPING:400,SERP_URL_PATTERN:/[#?&]source=hp/,get _isOrganic(){return!n.Utils.g.getSearchParams(location.href).tbm},_clearResults:function(){this._currentResults&&this._currentResults.destroy(),this._currentResults=null,this._currentQParams=null},_reportResultsIfQueriesMatch:function(){this._currentResults&&this._currentResults.isSameSearchAs(this._currentQParams)&&(this._currentResults.report(this._isLastWasIndex),this._isLastWasIndex=!1)},_onPopState:function(){this._isOrganic?(this._currentQParams=n.Utils.g.getSearchParams(location.href),this._reportResultsIfQueriesMatch()):this._clearResults()},_onResultsRendered:function(){var e=this;this._isOrganic?(this._currentResults&&this._currentResults.destroy(),setTimeout(function(){e._currentResults=new qi,e._reportResultsIfQueriesMatch()},this.DELAY_BEFORE_SCRAPPING)):this._clearResults()},triggeResultClicked:function(){this._isOrganic?this._currentResults&&(this._currentResults.report(this._isLastWasIndex),this._isLastWasIndex=!1):this._clearResults()},get _isDOMStateDifferent(){var e=Ri(".qs");return!!e&&(e!==this._lastQs&&(this._lastQs=e,!0))},get _areQParamsDifferent(){var e=n.Utils.g.getSearchParams(location.href);return!this._currentQParams&&e.q||e.q!==this._currentQParams.q||e.s!=this._currentQParams.s},get _isResultBlockVisible(){var e=Ri("#search");return!!e&&"hidden"!==e.style.visibility},get _isIndexPage(){return this.SERP_URL_PATTERN.test(window.location.href)},_startPolling:function(){setInterval(this._onTimerTick.bind(this),this.POLLING_INTERVAL)},_onTimerTick:function(){this._isResultBlockVisible&&this._isDOMStateDifferent&&this._onResultsRendered(),this._areQParamsDifferent&&this._onPopState(),this._isLastWasIndex||(this._isLastWasIndex=this._isIndexPage)}};var Mi=new Di,ji=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();i(131),window.downloads=Yt;var Bi=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._options=r.a,this._cache=o,this._manager=jt,this._mediaScanner=new Ht(this._manager),this._overlay=Vt,this._options.load().then(this._init.bind(this)),this._pip=_t,this._exportGlobals(),this._controls=null,this._jwtTool=Gt.a,this._shouldHideWidget=!1,this._isPanelWindow=!1}return ji(e,[{key:"_init",value:function(){this.onMediaUpdate=this._onMediaUpdate.bind(this),this.onUnload=this._onUnload.bind(this),this.onMessageReceived=this._onMessageReceived.bind(this),window.onbeforeunload=this.onUnload,this._mediaScanner.on("media_update",this.onMediaUpdate),this._pip.on("tab_detached",this._onPiPDetach.bind(this)),chrome.runtime.onMessage.addListener(this.onMessageReceived),this._doNotShowWidgetByToken().then(function(e){this._shouldHideWidget=e}.bind(this)).catch(function(e){console.warn(e)}),this._checkWindowType()}},{key:"_exportGlobals",value:function(){window.cache=this._cache,document.addEventListener("DOMContentLoaded",function(){window.pageComm=new Xt})}},{key:"_hasMedia",value:function(e){return!!n.Utils.flatten(n.Utils.toArray(e)).filter(function(e){return!!(e&&e.ids&&Array.isArray(e.ids)&&n.Utils.flatten(e.ids).length>0)}).length}},{key:"_onMediaUpdate",value:function(e){var t=this._hasMedia(e);n.BGUtils.sendMessage({requestType:"media",method:"set_present",params:t})?(this._controls||!document.documentElement||!this.canShowControls||this._shouldHideWidget||this._isPanelWindow||(this._controls=_i(document.documentElement)),this._controls&&this._controls.setMediaPlayers(this._manager,e)):this.onUnload()}},{key:"_onMessageReceived",value:function(e,t,i){var n=null;switch(e.requestType){case"get_media":jt.getMedia().then(function(e){i(e)});break;case"downloads":n=window.downloads.processRequest(e.method,e.params);break;case"request.matched":jt.processRequest(e);break;case"restore_tab":this._mediaScanner.start(),this._pip.restore(),this._controls.switchForceHide(!1);break;case"page_changed":this._controls.destroy(),this._controls=_i(document.documentElement);break;case"hide_playnow_tooltip":this._controls&&this._controls.playNowBottomTooltip&&this._controls.playNowBottomTooltip.hide()}return n&&n.then(function(e){i({success:n.state===Promise.RESOLVED,data:e})}),!0}},{key:"_onPiPDetach",value:function(e){this._mediaScanner.pause(),n.BGUtils.sendMessage({requestType:"pip",method:"detachTab",params:e}),this._controls&&this._controls.playNowBottomTooltip&&this._controls.playNowBottomTooltip.hide(),this._controls.switchForceHide(!0)}},{key:"_onUnload",value:function(){this._controls&&this._controls.destroy(),this._overlay.destroy(),this._mediaScanner.destroy(),this._pip.isPanelMode&&n.BGUtils.sendMessage({requestType:"pip",method:"restorePanelToTab",params:null})}},{key:"_doNotShowWidgetByToken",value:function(){return new Promise(function(e){var t=n.Utils.query("[data-savior-token]");t||e(!1);var i=t.getAttribute("data-savior-token"),r=location.host,a=this._jwtTool.parsePayload(i.split(".")[1]);null===a&&e(!1),this._jwtTool.checkURLPattern(a.host,r)?n.BGUtils.sendMessage({requestType:"verify_token",params:{token:i,host:r}},function(t){e(t.data)}):e(!1)}.bind(this))}},{key:"_checkWindowType",value:function(){this._isPanelWindow=!0,chrome.runtime.sendMessage({requestType:"should_show_widget"},function(e){e&&"resolve"===e.success&&e.data&&(this._isPanelWindow=!1)}.bind(this))}},{key:"_start",value:function(){n.BGUtils.sendMessage({requestType:"media",method:"reset_all"}),this._mediaScanner.start()}},{key:"canShowControls",get:function(){return"file:"!==location.protocol&&""!==location.hostname&&"localhost"!==location.hostname}}]),e}());Bi._start();var Wi=t.default=Bi},96:function(e,t,i){"use strict";e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},97:function(e,t,i){"use strict";var n=String.prototype.indexOf;e.exports=function(e){return n.call(this,e,arguments[1])>-1}},98:function(e,t,i){"use strict";var n="razdwatrzy";e.exports=function(){return"function"==typeof n.contains&&(!0===n.contains("dwa")&&!1===n.contains("foo"))}},99:function(e,t,i){"use strict";e.exports=i(98)()?String.prototype.contains:i(97)}});